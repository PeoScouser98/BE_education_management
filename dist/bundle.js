(()=>{"use strict";var e={4235:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),a(1081);const r=s(a(3511)),n=a(8117),u=s(a(7130));function s(e){return e&&e.__esModule?e:{default:e}}r.default.use(new n.Strategy({clientID:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,callbackURL:"/api/auth/google/callback",passReqToCallback:!0},(function(e,t,a,r,n){u.default.findOne({email:r.email}).exec(((e,t)=>{if(e)return n(e,!1);if(!t)return n(null,!1);let a=t?.picture||r.picture;return n(null,{...t?.toObject(),picture:a})}))}))),r.default.serializeUser(((e,t)=>t(null,e))),r.default.deserializeUser(((e,t)=>t(null,e)))},3671:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=a(7055),n=s(a(3511)),u=s(a(7130));function s(e){return e&&e.__esModule?e:{default:e}}n.default.use(new r.Strategy({usernameField:"email",passReqToCallback:!0},(function(e,t,a,r){u.default.findOne({$or:[{phone:t},{email:t}]},(function(e,t){return e?r(e):t&&t.verifyPassword(a)?r(null,t):r(null,!1)}))}))),n.default.serializeUser(((e,t)=>t(null,e))),n.default.deserializeUser(((e,t)=>t(null,e)))},5355:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{signinWithGoogle:function(){return O},signinWithPhoneNumber:function(){return g},getUser:function(){return _},refreshToken:function(){return w},signout:function(){return j},verifyAccount:function(){return E},sendOtp:function(){return v},verifyUserByPhone:function(){return S},resetPassword:function(){return T}}),a(1081);const r=b(a(8931)),n=b(a(9344)),u=b(a(1017)),s=b(a(2057)),o=a(1548),i=b(a(9123)),d=b(a(2076)),l=b(a(1261)),c=b(a(2383)),f=a(3111),p=a(6880);a(4235);const y=b(a(7130)),m=b(a(4128)),h=a(3019);function b(e){return e&&e.__esModule?e:{default:e}}const O=(0,c.default)((async(e,t)=>{let a=e.user;if(!a)return t.redirect(s.default.CLIENT_URL+"/signin");let r=n.default.sign({payload:e.user},process.env.ACCESS_TOKEN_SECRET,{expiresIn:"24h"}),u=n.default.sign({payload:e.user},process.env.REFRESH_TOKEN_SECRET,{expiresIn:"30d"});return await Promise.all([i.default.set(f.AuthRedisKeyPrefix.ACCESS_TOKEN+a._id,r,{EX:86400}),i.default.set(f.AuthRedisKeyPrefix.REFRESH_TOKEN+a._id,u,{EX:2592e3})]),t.cookie("access_token",r,{maxAge:31536e6,httpOnly:!0}),t.cookie("uid",a?._id?.toString().trim(),{maxAge:2592e6,httpOnly:!0}),t.redirect(s.default.CLIENT_URL+"/signin/success")})),g=(0,c.default)((async(e,t)=>{let a=e.user,r=n.default.sign({payload:a},process.env.ACCESS_TOKEN_SECRET,{expiresIn:"1h"}),u=n.default.sign({payload:a},process.env.REFRESH_TOKEN_SECRET,{expiresIn:"30d"});return await Promise.all([i.default.set(f.AuthRedisKeyPrefix.ACCESS_TOKEN+a._id,r,{EX:3600}),i.default.set(f.AuthRedisKeyPrefix.REFRESH_TOKEN+a._id,u,{EX:2592e3})]),t.cookie("access_token",r,{maxAge:31536e6,httpOnly:!0}),t.cookie("uid",a?._id?.toString().trim(),{maxAge:31536e6,httpOnly:!0}),t.status(o.HttpStatusCode.OK).json({user:e.user,accessToken:r})})),_=(0,c.default)((async(e,t)=>{if(!e.profile)throw r.default.NotFound("Failed to get user's info");return t.status(o.HttpStatusCode.OK).json(e.profile)})),w=(0,c.default)((async(e,t)=>{let a=await i.default.get(f.AuthRedisKeyPrefix.REFRESH_TOKEN+e.cookies.uid);if(!a)throw r.default.BadRequest("Invalid refresh token!");let u=n.default.verify(a,process.env.REFRESH_TOKEN_SECRET);if(!u.payload)throw r.default.Forbidden("Invalid token payload");let s=n.default.sign(u.payload,process.env.ACCESS_TOKEN_SECRET,{expiresIn:"30m"});return await i.default.set(f.AuthRedisKeyPrefix.ACCESS_TOKEN+e.cookies.uid,s,{EX:3600}),t.cookie("access_token",s,{maxAge:31536e6,httpOnly:!0}),t.status(o.HttpStatusCode.OK).json({refreshToken:s,statusCode:o.HttpStatusCode.OK,message:"ok"})})),j=(0,c.default)((async(e,t)=>{let a={accessToken:f.AuthRedisKeyPrefix.ACCESS_TOKEN+e.profile._id,refreshToken:f.AuthRedisKeyPrefix.REFRESH_TOKEN+e.profile._id};return await i.default.get(a.accessToken)?(await Promise.all([i.default.del(a.accessToken),i.default.del(a.refreshToken)]),e.logout((e=>{if(e)throw e})),t.clearCookie("access_token"),t.clearCookie("uid"),t.clearCookie("connect.sid",{path:"/"}),t.status(202).json({message:"Signed out!",statusCode:202})):t.status(400).json({message:"Failed to revoke token",statusCode:400})})),E=(0,c.default)((async(e,t)=>{let a=e.query._token;if(!a)throw r.default.Unauthorized("Access token must be provided!");let{auth:s}=n.default.verify(a,process.env.ACCESS_TOKEN_SECRET),o=e.query._role===p.UserRoleEnum.TEACHER?{isVerified:!0,employmentStatus:!0}:{isVerified:!0};return await y.default.findOneAndUpdate({email:s},o,{new:!0}),t.setHeader("Content-Security-Policy","script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com"),t.setHeader("Cross-origin-Embedder-Policy","same-origin"),t.setHeader("Access-Control-Allow-Origin","*"),t.sendFile(u.default.resolve(u.default.join(__dirname,"../views/send-mail-response.html")))})),v=(0,c.default)((async(e,t)=>{let a=await y.default.findOne({phone:e.body.phone});if(!a)throw r.default.NotFound("User's phone number does not exist!");let n=(0,l.default)();await i.default.set(f.AuthRedisKeyPrefix.OTP_KEY+a._id,n,{EX:3600}),console.log("OTP is ",n);let u=await(0,m.default)({to:(0,d.default)(e.body.phone),text:`Mã xác thực của bạn là ${n}`});if(!u)throw r.default.InternalServerError("Failed to send sms!");return t.status(o.HttpStatusCode.OK).json(u)})),S=(0,c.default)((async(e,t)=>{if(!e.body.verifyCode)throw r.default.BadRequest("Verify code must be provided!");let a=await i.default.get(f.AuthRedisKeyPrefix.OTP_KEY+e.params.userId);if(!a)throw r.default.Gone("Code is expired!");if(e.body.verifyCode!==a)return t.status(400).json({message:"Incorrect verify code!",statusCode:400});let u=n.default.sign({payload:e.params.userId},process.env.ACCESS_TOKEN_SECRET,{expiresIn:"5m"});return t.cookie("access_token",u,{maxAge:3e5}),await i.default.del(f.AuthRedisKeyPrefix.OTP_KEY+e.params.userId),t.status(o.HttpStatusCode.OK).json({message:"Ok",statusCode:o.HttpStatusCode.OK,data:{accessToken:u,isSuccess:!0}})})),T=(0,c.default)((async(e,t)=>{if(!e.cookies.access_token)throw r.default.Unauthorized("");let a=n.default.verify(e.cookies.access_token,process.env.ACCESS_TOKEN_SECRET);return await(0,h.changePassword)(a.payload,e.body.newPassword),t.status(o.HttpStatusCode.OK).json({message:"Ok",statusCode:o.HttpStatusCode.OK})}))},9105:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{createClass:function(){return c},updateClass:function(){return f},removeClass:function(){return p},restoreClass:function(){return y},getClasses:function(){return m},getOneClass:function(){return h},getClassTrash:function(){return b}});const r=d(a(8931)),n=a(1185),u=a(1548),s=d(a(2383)),o=d(a(3562)),i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=l(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var s=n?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(r,u,s):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(4923));function d(e){return e&&e.__esModule?e:{default:e}}function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(l=function(e){return e?a:t})(e)}const c=(0,s.default)((async(e,t)=>{let{classes:a}=await i.createClass(e.body);return t.status(u.HttpStatusCode.CREATED).json(a)})),f=(0,s.default)((async(e,t)=>{let a=e.params.id,r=e.body,n=await i.updateClass(r,a);return t.status(u.HttpStatusCode.CREATED).json(n)})),p=(0,s.default)((async(e,t)=>{let a,n=e.params.id,s=e.query._option||"soft";if(!n)throw(0,r.default)(u.HttpStatusCode.NO_CONTENT);switch(s){case"soft":a=await i.softDeleteClass(n);break;case"force":a=await i.forceDeleteClass(n);break;default:throw r.default.InternalServerError("InternalServerError")}return t.status(a.statusCode).json(a)})),y=(0,s.default)((async(e,t)=>{let a=e.params.id;if(!a||!(0,n.isValidObjectId)(a))throw r.default.BadRequest("Invalid class ID !");let s=await i.restoreClass(a);return t.status(u.HttpStatusCode.CREATED).json(s)})),m=(0,s.default)((async(e,t)=>{let a=e.query._sort?.toString()||"grade",n="desc"===e.query._order?1:-1;if(!["className","grade","createdAt","updatedAt"].includes(a))throw r.default.BadRequest("_sort can only belong to ['className', 'grade','createdAt','updatedAt']");let s=await i.getAllClass({[a]:n});return t.status(u.HttpStatusCode.OK).json(s)})),h=(0,s.default)((async(e,t)=>{let a=e.params.id;if(!a||!(0,n.isValidObjectId)(a))throw r.default.BadRequest("Missing parameter");let s=await i.getOneClass(a);if(!s)throw r.default.NotFound("Class not found");return t.status(u.HttpStatusCode.OK).json(s)})),b=(0,s.default)((async(e,t)=>{let a=await o.default.findWithDeleted({deleted:!0});return t.status(u.HttpStatusCode.OK).json(a)}))},6886:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{getFiles:function(){return p},uploadFile:function(){return y},updateFile:function(){return m},deleteFile:function(){return h},restoreFile:function(){return b}}),a(1081);const r=l(a(8931)),n=a(2407),u=f(a(6954)),s=f(a(4720)),o=a(7848),i=a(1548),d=l(a(2383));function l(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(c=function(e){return e?a:t})(e)}function f(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=c(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var s=n?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(r,u,s):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}const p=(0,d.default)((async(e,t)=>{let a=(0,n.multiFieldSortObjectParser)({_sort:e.query._sort,_order:e.query._order}),r={limit:+e.query._limit||20,page:+e.query._page,sort:a||{}};if(e.query._grade||e.query._subject){let a=await s.getFiles({subject:e.query._subject,grade:e.query._grade},r);return t.status(i.HttpStatusCode.OK).json(a)}{let e=await s.getFiles({deleted:!1},r);return t.status(i.HttpStatusCode.OK).json(e)}})),y=(0,d.default)((async(e,t)=>{let[a]=e.files;if(!a)throw r.default.BadRequest("File must be provided!");if(!(0,o.checkValidMimeType)(a))throw r.default.UnprocessableEntity("File type is not allowed to upload!");let n=await u.uploadFile(a,process.env.FOLDER_ID),d={fileId:n?.data.id,fileName:a.originalname,mimeType:a.mimetype,subject:e.body.subject,grade:+e.body.grade},l=await s.saveFile(d);return t.status(i.HttpStatusCode.CREATED).json(l)})),m=(0,d.default)((async(e,t)=>{let a=await s.updateFile(e.params.fileId,e.body);return t.status(i.HttpStatusCode.CREATED).json(a)})),h=(0,d.default)((async(e,t)=>{if(e.query.hard_delete){let a=await s.hardDeleteFile(e.params.fileId),r=await u.deleteFile(e.params.fileId);return t.status(i.HttpStatusCode.NO_CONTENT).json({deletedFile:r,deletedFileInDb:a})}{let a=await s.softDeleteFile(e.params.fileId);return t.status(i.HttpStatusCode.NO_CONTENT).json(a)}})),b=(0,d.default)((async(e,t)=>{let a=await s.restoreDeletedFile(e.params.fileId);return t.status(i.HttpStatusCode.OK).json(a)}))},3750:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{getPermissionByRole:function(){return f},createPermission:function(){return p},deletePermission:function(){return y},restoreDeletedPermission:function(){return m},updatePermission:function(){return h}});const r=l(a(8931)),n=a(1185),u=a(6880),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=c(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var s=n?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(r,u,s):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(7273)),o=a(8719),i=a(1548),d=l(a(2383));function l(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(c=function(e){return e?a:t})(e)}const f=(0,d.default)((async(e,t)=>{let a=e.query._role;if(!a)throw r.default.BadRequest("Missing parameter: role");if(!Object.values(u.UserRoleEnum).includes(a))throw r.default.BadRequest(`User's role parameter must be one of these: ${Object.values(u.UserRoleEnum)}`);let n=await s.getPermissionByRole(a);if(!n)throw r.default.NotFound("Permission not found");return t.status(i.HttpStatusCode.OK).json(n)})),p=(0,d.default)((async(e,t)=>{let{error:a}=(0,o.validatePermissionData)(e.body);if(a)throw r.default.BadRequest(a.message);let n=await s.createPermission(e.body);if(!n)throw r.default.BadRequest("Permission not created!");return t.status(i.HttpStatusCode.CREATED).json(n)})),y=(0,d.default)((async(e,t)=>{let a,{id:u}=e.params,o=e.query._option||"soft";if(!(0,n.isValidObjectId)(u))throw r.default.BadRequest("Invalid ID!");switch(o){case"soft":a=await s.deletePermission(u);break;case"force":a=await s.forceDeletePermission(u);break;default:throw r.default.BadRequest("Invalid query")}return t.status(i.HttpStatusCode.OK).json(a)})),m=(0,d.default)((async(e,t)=>{let a=e.params.id;if(!a||!(0,n.isValidObjectId)(a))throw r.default.BadRequest("Invalid ID!");let u=await s.restoreDeletedPermission(a);if(!u)throw r.default.NotFound("Permission not found");return t.status(i.HttpStatusCode.CREATED).json(u)})),h=(0,d.default)((async(e,t)=>{let{id:a}=e.params,u=e.body,{error:d}=(0,o.validatePermissionData)(u);if(!a)throw r.default.BadRequest("Missing ID parameter");if(!(0,n.isValidObjectId)(a))throw r.default.BadRequest("Invalid ID");if(d)throw r.default.BadRequest(d.message);let l=await s.updatePermission(a,u);if(!l)throw r.default.NotFound("Permission not found");return t.status(i.HttpStatusCode.OK).json(l)}))},1288:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{schoolYearList:function(){return o},getCurrentYear:function(){return i},createSchoolYear:function(){return d},updateSchoolYear:function(){return l}});const r=a(1548),n=function(e){return e&&e.__esModule?e:{default:e}}(a(2383)),u=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=s(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var o=n?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(r,u,o):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(254));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(s=function(e){return e?a:t})(e)}const o=(0,n.default)((async(e,t)=>{let a=e.query._limit?Number(e.query._limit):10,n=e.query._page?Number(e.query._page):1,s=await u.getAllSchoolYear(a,n);return t.status(r.HttpStatusCode.OK).json(s)})),i=(0,n.default)((async(e,t)=>{let a=await u.getCurrentSchoolYear();return t.status(200).json(a)})),d=(0,n.default)((async(e,t)=>{let a=await u.createSchoolYear(e.body);return t.status(r.HttpStatusCode.CREATED).json(a)})),l=(0,n.default)((async(e,t)=>{let a=await u.updateSchoolYear(e.params.id,e.body);return t.status(r.HttpStatusCode.CREATED).json(a)}))},9732:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{createStudent:function(){return c},updateStudent:function(){return f},getStudentByClass:function(){return p},getStudentDetail:function(){return y},serviceStudent:function(){return m},getStudentStop:function(){return h},attendanceStudentByClass:function(){return b},selectAttendanceByClass:function(){return O},selectAttendanceByStudent:function(){return g},getPolicyBeneficiary:function(){return _},selectAttendanceAllClass:function(){return w}});const r=d(a(8931)),n=a(1185),u=a(7790),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=l(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var s=n?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(r,u,s):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(4051)),o=a(1548),i=d(a(2383));function d(e){return e&&e.__esModule?e:{default:e}}function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(l=function(e){return e?a:t})(e)}const c=(0,i.default)((async(e,t)=>{let a=await s.createStudent(e.body);return t.status(o.HttpStatusCode.CREATED).json(a)})),f=(0,i.default)((async(e,t)=>{let a=e.params.id,u=e.body;if(!(0,n.isValidObjectId)(a))throw r.default.BadRequest("Invalid student ID !");let i=await s.updateStudent(a,u);return t.status(o.HttpStatusCode.CREATED).json(i)})),p=(0,i.default)((async(e,t)=>{let a=e.params.class,r="desc"===e.query._order?1:-1,n=e.query._sort?.toString()||"fullName",u=e.query.select?.toString()||"",i=await s.getStudentByClass(a,r,n,u);return t.status(o.HttpStatusCode.OK).json(i)})),y=(0,i.default)((async(e,t)=>{let a=e.params.id,r=await s.getDetailStudent(a);return t.status(o.HttpStatusCode.OK).json(r)})),m=(0,i.default)((async(e,t)=>{let a=e.params.id,{type:n,date:u}=e.body,i=null;switch(n){case"transferSchool":i=await s.setStudentTransferSchool(a,u);break;case"dropout":i=await s.setDropoutStudent(a,u);break;default:throw(0,r.default)(400,"Type is not valid")}return t.status(o.HttpStatusCode.CREATED).json(i)})),h=(0,i.default)((async(e,t)=>{let a=e.params.type,n=e.query._page||1,u=e.query._limit||10,i=e.query._year||(new Date).getFullYear(),d=[];switch(a){case"transferSchool":d=await s.getStudentTransferSchool(Number(i),Number(n),Number(u));break;case"dropout":d=await s.getStudentDropout(Number(i),Number(n),Number(u));break;default:throw(0,r.default)(400,"Type is not valid")}return t.status(o.HttpStatusCode.OK).json(d)})),b=(0,i.default)((async(e,t)=>{let a=e.params.classId,r=e.body,n=await s.markAttendanceStudent(a,r);return t.status(o.HttpStatusCode.CREATED).json(n)})),O=(0,i.default)((async(e,t)=>{let a=e.params.classId,r=e.query._date;r=new Date(r?(0,u.formatDate)(new Date(r)):(0,u.formatDate)(new Date));let n=await s.dailyAttendanceList(a,r);return t.status(o.HttpStatusCode.OK).json(n)})),g=(0,i.default)((async(e,t)=>{let a=e.params.id,r=e.query._month||(new Date).getMonth()+1,n=e.query._year||(new Date).getFullYear(),u=await s.attendanceOfStudentByMonth(a,Number(r),Number(n));return t.status(o.HttpStatusCode.OK).json(u)})),_=(0,i.default)((async(e,t)=>{let a=e.query._page||1,r=e.query._limit||10,n=await s.getPolicyBeneficiary(Number(a),Number(r));return t.status(o.HttpStatusCode.OK).json(n)})),w=(0,i.default)((async(e,t)=>{let a=e.query._page||1,r=e.query._limit||10,n=e.query._date;n=new Date(n?(0,u.formatDate)(new Date(n)):(0,u.formatDate)(new Date));let i=await s.getAttendanceAllClass(Number(a),Number(r),n);return t.status(o.HttpStatusCode.OK).json(i)}))},6799:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createStudentRemark",{enumerable:!0,get:function(){return o}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(2383)),n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=s(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var o=n?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(r,u,o):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(4875)),u=a(1548);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(s=function(e){return e?a:t})(e)}const o=(0,r.default)((async(e,t)=>{let a=await n.createStudentRemark(e.body,e.profile?._id);return t.status(u.HttpStatusCode.CREATED).json(a)}))},709:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{getAllSubjects:function(){return d},getOneSubject:function(){return l},createSubject:function(){return c},updateSubject:function(){return f},deleteSubject:function(){return p},restore:function(){return y},getTrash:function(){return m}});const r=o(a(8931)),n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=i(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var s=n?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(r,u,s):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(7696)),u=a(1548),s=o(a(2383));function o(e){return e&&e.__esModule?e:{default:e}}function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(i=function(e){return e?a:t})(e)}const d=(0,s.default)((async(e,t)=>{let a=await n.getAllSubjects();if(!a)throw r.default.NotFound("Cannot get subjects!");return t.status(u.HttpStatusCode.OK).json(a)})),l=(0,s.default)((async(e,t)=>{let a=await n.getOneSubject(e.params.id);return t.status(u.HttpStatusCode.OK).json(a)})),c=(0,s.default)((async(e,t)=>{let a=await n.createNewSubject(e.body);if(!a)throw r.default.BadRequest("Cannot create new subject!");return t.status(u.HttpStatusCode.CREATED).json(a)})),f=(0,s.default)((async(e,t)=>{let a=e.params.id,r=await n.updateSubject(a,e.body);return t.status(u.HttpStatusCode.CREATED).json(r)})),p=(0,s.default)((async(e,t)=>{let a,s=e.params.id,o=e.query._option||"soft";if(!s)throw(0,r.default)(u.HttpStatusCode.NO_CONTENT);switch(o){case"soft":a=await n.deleteSoft(s);break;case"force":a=await n.deleteForce(s);break;default:throw r.default.InternalServerError("InternalServerError")}return t.status(u.HttpStatusCode.NO_CONTENT).json(a)})),y=(0,s.default)((async(e,t)=>{let a=e.params.id,r=await n.restore(a);return t.status(r.statusCode).json(r)})),m=(0,s.default)((async(e,t)=>{let a=await n.getTrash();return t.status(u.HttpStatusCode.OK).json(a)}))},6858:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{scoreTableInputs:function(){return f},scoreTableInputOne:function(){return p},getTranscriptByClass:function(){return y},getTranscriptByStudent:function(){return m},selectTranscriptAllSubjectByClass:function(){return h}});const r=c(a(6950)),n=a(1548),u=d(a(2383)),s=a(254),o=c(a(1185)),i=d(a(8931));function d(e){return e&&e.__esModule?e:{default:e}}function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(l=function(e){return e?a:t})(e)}function c(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=l(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var s=n?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(r,u,s):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}const f=(0,u.default)((async(e,t)=>{let a=e.body,u=e.params.subjectId,s=e.params.classId,o=await r.newScoreList(u,s,a);return t.status(n.HttpStatusCode.CREATED).json(o)})),p=(0,u.default)((async(e,t)=>{let a=e.body,u=e.params.subjectId,s=e.params.studentId,o=await r.newScore(u,s,a);return t.status(n.HttpStatusCode.CREATED).json(o)})),y=(0,u.default)((async(e,t)=>{let a=e.params.subjectId,u=e.params.classId,s=await r.selectSubjectTranscriptByClass(u,a);return t.status(n.HttpStatusCode.OK).json(s)})),m=(0,u.default)((async(e,t)=>{let a=e.params.id,u=await r.getStudentTranscript(a);return t.status(n.HttpStatusCode.OK).json(u)})),h=(0,u.default)((async(e,t)=>{let a=e.params.classId,u=await(0,s.getCurrentSchoolYear)(),d=e.query._schoolYear,l=d&&(0,o.isValidObjectId)(d)?new o.default.Types.ObjectId(d):u._id;if(!(0,o.isValidObjectId)(l))throw i.default.BadRequest("Invalid school year ID !");let c=await r.selectTranscriptAllSubjectByClass(a,l);return t.status(n.HttpStatusCode.OK).json(c)}))},4287:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{createTimeTable:function(){return c},updateTimeTable:function(){return f},deleteTimeTable:function(){return p},getTimeTableByClass:function(){return y},getTeacherTimetable:function(){return m}});const r=d(a(8931)),n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=l(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var s=n?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(r,u,s):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(1177)),u=a(9868),s=a(1548),o=d(a(2383)),i=a(1185);function d(e){return e&&e.__esModule?e:{default:e}}function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(l=function(e){return e?a:t})(e)}const c=(0,o.default)((async(e,t)=>{let{error:a}=(0,u.validateNewTimeTable)(e.body);if(a)throw r.default.BadRequest(a.message);let o=await n.createTimetable(e.body);return t.status(s.HttpStatusCode.CREATED).json(o)})),f=(0,o.default)((async(e,t)=>{let{error:a}=(0,u.validateUpdateTimeTablePayload)(e.body);if(a)throw r.default.BadRequest(a.message);let o=await n.updateTimetable({classId:e.params.classId,payload:e.body});if(!o)throw r.default.NotFound("Cannot find time table to update!");return t.status(s.HttpStatusCode.CREATED).json(o)})),p=(0,o.default)((async(e,t)=>{if(!await n.deleteTimeTable(e.params.classId))throw r.default.NotFound("Cannot find time table to delete!");return t.status(s.HttpStatusCode.NO_CONTENT).json({message:"Deleted!",statusCode:s.HttpStatusCode.NO_CONTENT})})),y=(0,o.default)((async(e,t)=>{let a=await n.getTimetableByClass(e.params.classId);if(!a)throw r.default.NotFound("Time table not found!");return t.status(s.HttpStatusCode.OK).json(a)})),m=(0,o.default)((async(e,t)=>{let a=e.query._classId;if(!a||!(0,i.isValidObjectId)(a))throw r.default.BadRequest("Invalid class ID");let u=await n.getTeacherTimeTableByClass(e.params.teacherId,a);return t.status(s.HttpStatusCode.OK).json(u)}))},3793:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{createTeacherAccount:function(){return y},createParentsAccount:function(){return m},updateTeacherInfo:function(){return h},getTeachersByStatus:function(){return b},deactivateTeacherAccount:function(){return O},getParentsUserByClass:function(){return g},searchParentsUsers:function(){return _},getUserDetails:function(){return w},updateUserInfo:function(){return j},updateParentsInfo:function(){return E}}),a(1081);const r=f(a(8931)),n=f(a(9344)),u=a(1548),s=a(5550),o=f(a(2383)),i=a(6880),d=a(7822),l=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=p(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var s=n?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(r,u,s):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(3019)),c=a(3326);function f(e){return e&&e.__esModule?e:{default:e}}function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(p=function(e){return e?a:t})(e)}const y=(0,o.default)((async(e,t)=>{let{error:a}=(0,c.validateNewTeacherData)(e.body);if(a)throw r.default.BadRequest(a.message);let o=await l.createUser({...e.body,role:i.UserRoleEnum.TEACHER}),f=n.default.sign({auth:o.email},process.env.ACCESS_TOKEN_SECRET,{expiresIn:"7d"}),p=e.protocol+"://"+e.get("host");return await(0,d.sendMail)((0,s.getVerificationEmailTemplate)({redirectDomain:p,user:{...e.body,role:i.UserRoleEnum.TEACHER},token:f})),t.status(u.HttpStatusCode.CREATED).json(o)})),m=(0,o.default)((async(e,t)=>{let{error:a,value:o}=(0,c.validateNewParentsData)(e.body);if(a)throw r.default.BadRequest(a.message);let f=Array.isArray(o)?o.map((e=>({...e,role:i.UserRoleEnum.PARENTS}))):{...o,role:i.UserRoleEnum.PARENTS},p=await l.createUser(f),y=e.protocol+"://"+e.get("host");if(Array.isArray(f)){let e=f.map((e=>new Promise((t=>{let a=n.default.sign({auth:e?.email},process.env.ACCESS_TOKEN_SECRET,{expiresIn:"7d"});(0,d.sendMail)((0,s.getVerificationEmailTemplate)({redirectDomain:y,token:a,user:e})).then((e=>t(e))).catch((e=>t(e)))}))));await Promise.all(e)}else{let e=n.default.sign({auth:f?.email},process.env.ACCESS_TOKEN_SECRET,{expiresIn:"7d"});(0,d.sendMail)((0,s.getVerificationEmailTemplate)({redirectDomain:y,token:e,user:f}))}return t.status(u.HttpStatusCode.CREATED).json(p)})),h=(0,o.default)((async(e,t)=>{let a=e.params.teacherId,{error:n,value:s}=(0,c.validateUpdateUserData)(e.body);if(n)throw r.default.BadRequest(n.message);let o=await l.updateTeacherInfo(a,s);if(!o)throw r.default.NotFound("Cannot find teacher to update!");return t.status(u.HttpStatusCode.CREATED).json(o)})),b=(0,o.default)((async(e,t)=>{let a=e.query._status,n=await l.getTeacherUsersByStatus(a);if(!n)throw r.default.NotFound("Không thể tìm thấy giáo viên nào!");return t.status(u.HttpStatusCode.OK).json(n)})),O=(0,o.default)((async(e,t)=>{let a=await l.deactivateTeacherUser(e.params.userId);if(!a)throw r.default.NotFound("Cannot find teacher to deactivate!");return t.status(u.HttpStatusCode.CREATED).json(a)})),g=(0,o.default)((async(e,t)=>{let a=await l.getParentsUserByClass(e.params.classId);return t.status(u.HttpStatusCode.OK).json(a)})),_=(0,o.default)((async(e,t)=>{let a=await l.searchParents(e.body.searchTerm);if(!a)throw r.default.NotFound("Cannot find any parents account!");return t.status(u.HttpStatusCode.OK).json(a)})),w=(0,o.default)((async(e,t)=>{let a=await l.getUserDetails(e.params.userId);if(!a)throw r.default.NotFound("User not found!");return t.status(u.HttpStatusCode.OK).json(a)})),j=(0,o.default)((async(e,t)=>{let{error:a,value:n}=(0,c.validateUpdateUserData)(e.body);if(a)throw r.default.BadRequest(a.message);let s=e.profile,o=await l.updateUserInfo(s,n);if(!o)throw r.default.BadRequest("User does not exist!");return t.status(u.HttpStatusCode.CREATED).json(o)})),E=(0,o.default)((async(e,t)=>{let{parentsId:a}=e.params,{error:n,value:s}=(0,c.validateUpdateUserData)(e.body);if(n)throw r.default.BadRequest(n.message);let o=await l.updateParentsUserInfo(a,s);if(!o)throw r.default.NotFound("Cannot find parents user to update !");return t.status(u.HttpStatusCode.CREATED).json(o)}))},6542:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{checkAuthenticated:function(){return c},checkIsHeadmaster:function(){return f},checkIsTeacher:function(){return p}}),a(1081);const r=l(a(8931)),n=l(a(9344)),u=a(1548),s=l(a(9123)),o=a(2116),i=a(3111),d=a(6880);function l(e){return e&&e.__esModule?e:{default:e}}const c=async(e,t,a)=>{try{if(!e.cookies.uid)throw r.default.Unauthorized("Invalid auth id!");let t=i.AuthRedisKeyPrefix.ACCESS_TOKEN+e.cookies.uid;if(!await s.default.get(t))throw r.default.Unauthorized();let u=e.cookies.access_token;if(!u)throw r.default.Unauthorized();let{payload:o}=n.default.verify(u,process.env.ACCESS_TOKEN_SECRET);e.profile=o,e.role=o.role,a()}catch(e){let a=new o.HttpException(e);return t.status(a.statusCode).json(a)}},f=async(e,t,a)=>{try{if(e.role!==d.UserRoleEnum.HEADMASTER)throw r.default.Forbidden("Only headmaster allowed to access!");a()}catch(e){let a=new o.HttpException(e);return t.status(a.statusCode).json(a)}},p=async(e,t,a)=>{try{let r=Object.values(d.UserRoleEnum).filter((e=>e!==d.UserRoleEnum.PARENTS));if(-1===r.indexOf(e.role))return t.status(u.HttpStatusCode.FORBIDDEN).json({message:"Only teacher/headmaster allowed to access!",statusCode:u.HttpStatusCode.FORBIDDEN});a()}catch(e){let a=new o.HttpException(e);return t.status(a.statusCode).json(a)}}},3562:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});const r=s(a(1185)),n=s(a(314)),u=s(a(3760));function s(e){return e&&e.__esModule?e:{default:e}}const o=new r.default.Schema({className:{type:String,require:!0,trim:!0,uppercase:!0,unique:!0},grade:{type:Number,enum:[1,2,3,4,5],require:!0},headTeacher:{type:r.default.Types.ObjectId,ref:"Users",autopopulate:{select:"_id displayName phone email",options:{lean:!0}}}},{collection:"classes",timestamps:!0,toJSON:{virtuals:!0}});o.plugin(n.default),o.plugin(u.default,{overrideMethods:["find","findOne"],deletedAt:!0}),o.virtual("totalStudents",{localField:"_id",foreignField:"class",ref:"Students",count:!0,justOne:!1,options:{lean:!0}});const i=r.default.model("Classes",o)},8501:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return d}});const r=o(a(1185)),n=o(a(314)),u=o(a(3760)),s=o(a(8037));function o(e){return e&&e.__esModule?e:{default:e}}const i=new r.default.Schema({subject:{type:r.default.Types.ObjectId,ref:"Subjects",require:!0,autopopulate:!0},grade:{type:Number,enum:[1,2,3,4,5],require:!0},fileId:{type:String,require:!0,trim:!0},fileName:{type:String,required:!0,trim:!0},mimeType:{type:String,required:!0},downloadUrl:{type:String,default:""}});i.plugin(n.default),i.plugin(s.default),i.plugin(u.default,{overrideMethods:["find","findOne"],deletedAt:!0}),i.pre("save",(function(){this.downloadUrl="https://drive.google.com/uc?export=download&id="+this.fileId}));const d=r.default.model("learning_materials",i)},8321:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l}});const r=i(a(1185)),n=i(a(314)),u=i(a(3760)),s=a(8324),o=a(6880);function i(e){return e&&e.__esModule?e:{default:e}}const d=new r.default.Schema({role:{type:String,require:!0,trim:!0,enum:o.UserRoleEnum},type:{type:String,require:!0,trim:!0},permissions:[{type:{type:String,uppercase:!0},allowedActions:[{type:String,enum:s.PermissionActionsEnum}]}]});d.plugin(n.default),d.plugin(u.default,{deletedAt:!0,overrideMethods:!0});const l=r.default.model("Permissions",d)},6262:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});const r=s(a(1185)),n=s(a(8037)),u=a(7790);function s(e){return e&&e.__esModule?e:{default:e}}const o=new r.default.Schema({name:{type:String,required:!0,uppercase:!0,trim:!0},startAt:{type:Date},endAt:{type:Date}},{collection:"school_years",timestamps:!0,versionKey:!1});o.plugin(n.default),o.pre("save",(function(e){this.name&&"string"==typeof this.name&&(this.name=(0,u.toUpperCase)(this.name)),e()}));const i=r.default.model("SchoolYears",o)},2512:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return c}});const r=i(a(1185)),n=i(a(314)),u=i(a(8037)),s=a(7790),o=a(6880);function i(e){return e&&e.__esModule?e:{default:e}}const d=new r.default.Schema({code:{type:String,uppercase:!0,unique:!0},class:{type:r.default.Types.ObjectId,ref:"Classes"},fullName:{type:String,require:!0,trim:!0,minLength:6},parents:{type:r.default.Types.ObjectId,ref:"Users",autopopulate:{select:"_id displayName phone email",options:{lean:!0}}},gender:{type:String,require:!0,enum:Object.values(o.UserGenderEnum)},dateOfBirth:{type:Date,require:!0},isPolicyBeneficiary:{type:Boolean,default:!1},isGraduated:{type:Boolean,default:!1},transferSchool:{type:Date,default:null},dropoutDate:{type:Date,default:null},absentDays:{type:[{date:{type:Date,default:new Date},schoolYear:{type:r.default.Types.ObjectId,ref:"SchoolYears"},hasPermision:{type:Boolean,default:!1},reason:{type:String,minlength:8,maxLength:256,default:"Không có lý do"}}],default:[]}},{versionKey:!1,timestamps:!0,collection:"students"});d.plugin(u.default),d.plugin(n.default);const l=r.default.model("Students",d);d.pre("save",(function(){this.fullName=(0,s.toCapitalize)(this.fullName)}));const c=l},2544:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});const r=s(a(1185)),n=a(3),u=s(a(314));function s(e){return e&&e.__esModule?e:{default:e}}const o=new r.default.Schema({student:{type:r.default.Types.ObjectId,ref:"Students",required:!0,autopopulate:{select:"_id fullName",options:{lean:!0}}},schoolYear:{type:r.default.Types.ObjectId,ref:"SchoolYears",autopopulate:!0},conduct:{type:String,required:!0,enum:Object.values(n.StudentQualityEnum)},proficiency:{type:String,required:!0,enum:Object.values(n.StudentQualityEnum)},remark:{type:String,trim:!0},remarkedBy:{type:r.default.Types.ObjectId,required:!0,ref:"Users",autopopulate:{select:"_id displayName",options:{lean:!0}}}},{collection:"student_remarks",versionKey:!1,timestamps:!0});o.plugin(u.default);const i=r.default.model("StudentRemarks",o)},3664:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});const r=s(a(1185)),n=s(a(3760)),u=a(7790);function s(e){return e&&e.__esModule?e:{default:e}}const o=new r.default.Schema({subjectName:{type:String,required:!0},subjectCode:{type:String,unique:!0,uppercase:!0,required:!0},appliedForGrades:{type:[Number],required:!0,default:[1,2,3,4,5]},isMainSubject:{type:Boolean,required:!0},isElectiveSubject:{type:Boolean,required:!0}},{versionKey:!1,collection:"subjects",timestamps:!0});o.plugin(n.default,{overrideMethods:["find","findOne"],deletedAt:!0}),o.pre("save",(function(e){this.subjectName=(0,u.toCapitalize)(this.subjectName),e()}));const i=r.default.model("Subjects",o)},4729:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});const r=u(a(1185)),n=u(a(314));function u(e){return e&&e.__esModule?e:{default:e}}const s=new r.default.Schema({student:{type:r.default.Types.ObjectId,require:!0,ref:"Students",autopopulate:{select:"fullName -parents"}},schoolYear:{type:r.default.Types.ObjectId,ref:"SchoolYears",autopopulate:{select:"startAt endAt"},require:!0},subject:{type:r.default.Types.ObjectId,require:!0,ref:"Subjects",autopopulate:{select:"subjectName"}},isPassed:{type:Boolean,default:null},firstSemester:{midtermTest:{type:Number,default:null,min:0,max:10},finalTest:{type:Number,default:null,min:0,max:10}},secondSemester:{midtermTest:{type:Number,default:null,min:0,max:10},finalTest:{type:Number,default:null,min:0,max:10}}},{collection:"subject_transcriptions",timestamps:!0,versionKey:!1});s.plugin(n.default);const o=r.default.model("SubjectTranscriptions",s)},9374:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});const r=u(a(1185)),n=u(a(314));function u(e){return e&&e.__esModule?e:{default:e}}const s=new r.default.Schema({period:{type:Number,require:!0,enum:[1,2,3,4,5,6,7,8,9,10]},subject:{type:r.default.Types.ObjectId,ref:"Subjects",require:!0,autopopulate:{select:"subjectName _id"}},teacher:{type:r.default.Types.ObjectId,ref:"Users",require:!0,autopopulate:{select:"displayName _id",options:{id:!1}}}},{_id:!1}),o=new r.default.Schema({class:{type:r.default.Schema.Types.ObjectId,ref:"Classes",required:!0,autopopulate:{select:"className",options:{lean:!0}}},schedule:{monday:[s],tuesday:[s],wednesday:[s],thursday:[s],friday:[s],saturday:[s]}},{timestamps:!0,versionKey:!1,collection:"time_tables"});o.plugin(n.default);const i=r.default.model("TimeTables",o)},7130:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return y}});const r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=c(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var s=n?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(r,u,s):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(7096));a(1081);const n=l(a(1185)),u=l(a(3760)),s=l(a(314)),o=a(6880),i=l(a(2365)),d=a(7790);function l(e){return e&&e.__esModule?e:{default:e}}function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(c=function(e){return e?a:t})(e)}const f=new n.default.Schema({email:{type:String,trim:!0,unique:!0},phone:{type:String,require:!0,unique:!0},displayName:{type:String,require:!0,trim:!0},dateOfBirth:{type:Date,require:!0},address:{type:String,require:!0},gender:{type:String,require:!0,enum:Object.values(o.UserGenderEnum)},picture:{type:String,trim:!0,require:!0},eduBackground:{type:{qualification:String,universityName:String,graduatedAt:Date},_id:!1,default:null},employmentStatus:{type:Boolean,default:!1},role:{type:String,trim:!0,require:!0,enum:Object.values(o.UserRoleEnum)},isVerified:{type:Boolean,default:!1}},{timestamps:!0,versionKey:!1,toJSON:{virtuals:!0},autoIndex:!0});f.index({displayName:"text"}),f.virtual("children",{localField:"_id",foreignField:"parents",ref:"Students"}),f.virtual("userStatusText").get((function(){switch(!0){case!1===this.isVerified:return"Chưa kích hoạt";case this.employmentStatus&&this.isVerified:return"Đang làm việc";case!1===this.employmentStatus:return"Đã nghỉ việc"}})),f.methods.verifyPassword=function(e){return!!e&&r.default.compareSync(e,this.password)},f.pre("save",(function(e){this.password&&(this.password=r.default.hashSync(this.password,(0,r.genSaltSync)(+process.env.SALT_ROUND))),this.displayName=(0,d.toCapitalize)(this.displayName),e()})),f.plugin(u.default,{overrideMethods:["find","findOne","findOneAndUpdate"],deletedAt:!0}),f.plugin(i.default),f.plugin(s.default);const p=n.default.model("Users",f);p.createIndexes();const y=p},3813:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return c}});const r=i(a(6860)),n=i(a(3511)),u=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=d(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var s=n?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(r,u,s):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(5355)),s=i(a(2057)),o=a(6542);function i(e){return e&&e.__esModule?e:{default:e}}function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(d=function(e){return e?a:t})(e)}const l=r.default.Router();l.get("/auth/google",n.default.authenticate("google",{scope:["email","profile"]})),l.get("/auth/google/callback",n.default.authenticate("google",{failureRedirect:`${s.default.CLIENT_URL}/signin`}),u.signinWithGoogle),l.get("/auth/signout",o.checkAuthenticated,u.signout),l.get("/auth/user",o.checkAuthenticated,u.getUser),l.get("/auth/verify-account",u.verifyAccount),l.get("/auth/refresh-token",u.refreshToken),l.post("/auth/send-otp",u.sendOtp);const c=l},8447:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(6860)),n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=s(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var o=n?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(r,u,o):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(9105)),u=a(6542);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(s=function(e){return e?a:t})(e)}const o=r.default.Router();o.post("/classes",u.checkAuthenticated,u.checkIsHeadmaster,n.createClass),o.patch("/classes/:id/restore",u.checkAuthenticated,u.checkIsHeadmaster,n.restoreClass),o.patch("/classes/:id",u.checkAuthenticated,u.checkIsHeadmaster,n.updateClass),o.delete("/classes/:id",u.checkAuthenticated,u.checkIsHeadmaster,n.removeClass),o.get("/classes/trash",u.checkAuthenticated,u.checkIsHeadmaster,n.getClassTrash),o.get("/classes",u.checkAuthenticated,n.getClasses),o.get("/classes/:id",u.checkAuthenticated,u.checkIsTeacher,n.getOneClass);const i=o},2852:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return O}});const r=m(a(6860)),n=m(a(8158)),u=m(a(630)),s=m(a(8214)),o=m(a(3813)),i=m(a(8447)),d=m(a(5373)),l=m(a(5380)),c=m(a(5720)),f=m(a(6630)),p=m(a(8996)),y=m(a(369));function m(e){return e&&e.__esModule?e:{default:e}}const h=[i.default,n.default,o.default,u.default,f.default,s.default,y.default,p.default,c.default,d.default,l.default],b=r.default.Router();h.forEach((e=>{b.use(e)}));const O=b},8996:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return c}});const r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=i(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var s=n?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(r,u,s):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(6886)),n=o(a(6860)),u=o(a(1738)),s=a(6542);function o(e){return e&&e.__esModule?e:{default:e}}function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(i=function(e){return e?a:t})(e)}const d=(0,u.default)(),l=n.default.Router();l.post("/learning-materials/upload",s.checkAuthenticated,s.checkIsTeacher,d.any(),r.uploadFile),l.get("/learning-materials",s.checkAuthenticated,s.checkIsTeacher,r.getFiles),l.patch("/learning-materials/:fileId/edit",s.checkAuthenticated,s.checkIsTeacher,r.updateFile),l.delete("/learning-materials/:fileId/delete",s.checkAuthenticated,s.checkIsTeacher,r.deleteFile);const c=l},369:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(6860)),n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=s(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var o=n?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(r,u,o):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(3750)),u=a(6542);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(s=function(e){return e?a:t})(e)}const o=r.default.Router();o.get("/permissions/get-by-roll",u.checkAuthenticated,n.getPermissionByRole),o.post("/permissions",u.checkAuthenticated,u.checkIsHeadmaster,n.createPermission),o.patch("/permissions/:id",u.checkAuthenticated,u.checkIsHeadmaster,n.updatePermission),o.patch("/permissions/:id/restore",u.checkAuthenticated,u.checkIsHeadmaster,n.restoreDeletedPermission),o.delete("/permissions/:id",u.checkAuthenticated,u.checkIsHeadmaster,n.deletePermission);const i=o},8214:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(6860)),n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=s(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var o=n?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(r,u,o):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(1288)),u=a(6542);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(s=function(e){return e?a:t})(e)}const o=r.default.Router();o.get("/school-years/current",u.checkAuthenticated,n.getCurrentYear),o.get("/school-years",u.checkAuthenticated,n.schoolYearList),o.post("/school-years",u.checkAuthenticated,u.checkIsHeadmaster,n.createSchoolYear),o.patch("/school-years/:id",u.checkAuthenticated,u.checkIsHeadmaster,n.updateSchoolYear);const i=o},630:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return s}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(6860)),n=a(9732),u=r.default.Router();u.get("/students/attendance",n.selectAttendanceAllClass),u.get("/students/attendance/:classId",n.selectAttendanceByClass),u.get("/students/attendance/student/:id",n.selectAttendanceByStudent),u.get("/students/policyBeneficiary",n.getPolicyBeneficiary),u.get("/students/stop/:type",n.getStudentStop),u.get("/students/detail/:id",n.getStudentDetail),u.get("/students/:class",n.getStudentByClass),u.post("/students",n.createStudent),u.patch("/students/attendance/:classId",n.attendanceStudentByClass),u.patch("/students/services/:id",n.serviceStudent),u.patch("/students/:id",n.updateStudent);const s=u},5380:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(6860)),n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=s(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var o=n?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(r,u,o):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(6799)),u=a(6542);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(s=function(e){return e?a:t})(e)}const o=r.default.Router();o.post("/student-remark",u.checkAuthenticated,u.checkIsTeacher,n.createStudentRemark);const i=o},6630:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(6860)),n=a(6542),u=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=s(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var o=n?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(r,u,o):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(709));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(s=function(e){return e?a:t})(e)}const o=r.default.Router();o.patch("/subjects/restore/:id",n.checkAuthenticated,n.checkIsHeadmaster,u.restore),o.get("/subjects/trash",n.checkAuthenticated,n.checkIsTeacher,u.getTrash),o.post("/subjects",n.checkAuthenticated,n.checkIsHeadmaster,u.createSubject),o.get("/subjects/:id",n.checkAuthenticated,n.checkIsTeacher,u.getOneSubject),o.patch("/subjects/:id",n.checkAuthenticated,n.checkIsHeadmaster,u.updateSubject),o.delete("/subjects/:id",n.checkAuthenticated,n.checkIsHeadmaster,u.deleteSubject),o.get("/subjects",u.getAllSubjects);const i=o},5720:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(6860)),n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=s(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var o=n?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(r,u,o):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(6858)),u=a(6542);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(s=function(e){return e?a:t})(e)}const o=r.default.Router();o.post("/transcripts/:classId/:subjectId",u.checkAuthenticated,u.checkIsTeacher,n.scoreTableInputs),o.post("/transcripts/:studentId/:subjectId",u.checkAuthenticated,u.checkIsTeacher,n.scoreTableInputOne),o.get("/transcripts/class/:classId/:subjectId",u.checkAuthenticated,n.getTranscriptByClass),o.get("/transcripts/student/:id",u.checkAuthenticated,n.getTranscriptByStudent),o.get("/transcripts/:classId",u.checkAuthenticated,n.selectTranscriptAllSubjectByClass);const i=o},5373:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(6860)),n=a(6542),u=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=s(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var o=n?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(r,u,o):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(4287));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(s=function(e){return e?a:t})(e)}const o=r.default.Router();o.get("/time-table/:classId",u.getTimeTableByClass),o.post("/time-table/create",n.checkAuthenticated,n.checkIsHeadmaster,u.createTimeTable),o.patch("/time-table/:classId/update",n.checkAuthenticated,n.checkIsHeadmaster,u.updateTimeTable),o.delete("/time-table/:classId/delete",n.checkAuthenticated,n.checkIsHeadmaster,u.deleteTimeTable),o.get("/timetable/teacher/:teacherId",n.checkAuthenticated,u.getTeacherTimetable);const i=o},8158:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(6860)),n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=s(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var o=n?Object.getOwnPropertyDescriptor(e,u):null;o&&(o.get||o.set)?Object.defineProperty(r,u,o):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(3793)),u=a(6542);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(s=function(e){return e?a:t})(e)}const o=r.default.Router();o.post("/users/create-teacher-account",u.checkAuthenticated,u.checkIsHeadmaster,n.createTeacherAccount),o.post("/users/create-parents-account",u.checkAuthenticated,u.checkIsTeacher,n.createParentsAccount),o.patch("/users/teachers/:userId/deactivate",u.checkAuthenticated,u.checkIsHeadmaster,n.deactivateTeacherAccount),o.patch("/update-user",u.checkAuthenticated,n.updateUserInfo),o.patch("/users/:teacherId/update-teacher",u.checkAuthenticated,u.checkIsHeadmaster,n.updateTeacherInfo),o.patch("/users/parents/:parentsId",u.checkAuthenticated,u.checkIsTeacher,n.updateParentsInfo),o.get("/users/teachers",u.checkAuthenticated,n.getTeachersByStatus),o.get("/users/:userId",u.checkAuthenticated,n.getUserDetails),o.get("/users/parents/:classId",u.checkAuthenticated,n.getParentsUserByClass),o.post("/users/search-parents",u.checkAuthenticated,u.checkIsTeacher,n.searchParentsUsers);const i=o},4923:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{getOneClass:function(){return o},getAllClass:function(){return i},createClass:function(){return d},updateClass:function(){return l},softDeleteClass:function(){return c},restoreClass:function(){return f},forceDeleteClass:function(){return p}});const r=s(a(8931)),n=s(a(3562)),u=a(6813);function s(e){return e&&e.__esModule?e:{default:e}}const o=async e=>await n.default.findOne({_id:e}).populate({path:"totalStudents"}),i=async e=>await n.default.find().populate({path:"totalStudents"}).sort(e),d=async e=>{let{error:t}=(0,u.validateClassData)(e);if(t)throw r.default.BadRequest(t.message);if(await n.default.exists({className:e.className.toUpperCase()}))throw r.default.Conflict(`Class ${e.className} already exists`);return{classes:await new n.default(e).save()}},l=async(e,t)=>{let a=await n.default.findOne({_id:t});if(!a)throw r.default.NotFound("Classes does not exist");if(e.className&&!e.grade&&!e.className.startsWith(JSON.stringify(a?.grade)))throw r.default.BadRequest("Invalid Class name, class's name: grade+\"A|B|C|D...");let{error:s}=(0,u.validateClassEditData)(e);if(s)throw r.default.BadRequest(s.message);return await n.default.findOneAndUpdate({_id:t},e,{new:!0})},c=async e=>{let t=await n.default.findOne({_id:e}).populate("totalStudents");if(!t)throw r.default.NotFound("Cannot find class to delete");if(t.totalStudents>0)throw r.default.Conflict("Cannot delete class due to there are students in this class !");return await n.default.delete({_id:e}),{message:"Moved the class to the trash",statusCode:200}},f=async e=>(await n.default.restore({_id:e}),{message:"Class have been restored",statusCode:200}),p=async e=>{let t=await n.default.findOne({_id:e}).populate("totalStudents");if(!t)throw r.default.NotFound("Cannot find class to delete");if(t.totalStudents>0)throw r.default.Conflict("Cannot delete class due to there are students in this class !");return await n.default.deleteOne({_id:e}),{message:"Class has been permanently deleted",statusCode:200}}},6954:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{uploadFile:function(){return u},deleteFile:function(){return s}}),a(1081);const r=a(2781),n=a(582),u=async(e,t=process.env.FOLDER_ID)=>{try{let a=new r.Stream.PassThrough;a.end(e.buffer);let u=await n.drive.files.create({requestBody:{name:e.originalname,parents:[t]},media:{body:a},fields:"id"});return console.log(u),await(async e=>{try{return await n.drive.permissions.create({fileId:e,requestBody:{role:"reader",type:"anyone"}}),n.drive.files.get({fileId:e,fields:"webViewLink, webContentLink"})}catch(e){console.log(e)}})(u.data.id),u}catch(e){throw e}},s=async e=>{try{return await n.drive.files.delete({fileId:e})}catch(e){return Promise.resolve(e)}}},4720:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{getFiles:function(){return u},saveFile:function(){return s},updateFile:function(){return o},softDeleteFile:function(){return i},hardDeleteFile:function(){return d},restoreDeletedFile:function(){return l}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(8501)),n=a(6954),u=async(e,t)=>await r.default.paginate(e,t),s=async e=>await new r.default(e).save(),o=async(e,t)=>await r.default.findOneAndUpdate({fileId:e},t,{new:!0}),i=async e=>await r.default.delete({fileId:e}),d=async e=>await Promise.all([r.default.findOneAndDelete({fileId:e}),(0,n.deleteFile)(e)]),l=async e=>await r.default.restore({fileId:e})},7822:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"sendMail",{enumerable:!0,get:function(){return n}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(5103)),n=async({to:e,subject:t,html:a})=>await r.default.sendMail({from:{address:process.env.AUTH_EMAIL,name:"Tiểu học Bột Xuyên"},to:e,subject:t,html:a},((e,t)=>{e?console.log("Failed to send mail.\nError: ",e.message):console.log(t.response)}))},7273:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{createPermission:function(){return n},getPermissions:function(){return u},getPermissionByRole:function(){return s},deletePermission:function(){return o},forceDeletePermission:function(){return i},restoreDeletedPermission:function(){return d},updatePermission:function(){return l}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(8321)),n=async e=>await new r.default(e).save(),u=async()=>await r.default.find(),s=async e=>await r.default.find({role:e}),o=async e=>(await r.default.delete({_id:e}),{message:"The permission has been successfully moved to the trash",statusCode:200}),i=async e=>(await r.default.deleteOne({_id:e}),{message:"The permission has been successfully deleted permanently",statusCode:200}),d=async e=>(await r.default.restore({_id:e}),{message:"The permission has been successfully restored",statusCode:200}),l=async(e,t)=>await r.default.findOneAndUpdate({_id:e},t,{new:!0})},254:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{getAllSchoolYear:function(){return i},createSchoolYear:function(){return d},getCurrentSchoolYear:function(){return l},updateSchoolYear:function(){return c}});const r=o(a(8931)),n=a(7790),u=o(a(6262)),s=a(4361);function o(e){return e&&e.__esModule?e:{default:e}}const i=async(e,t)=>await u.default.paginate({},{limit:e,page:t,sort:{startAt:"asc"}}),d=async e=>{let t=await u.default.find().sort({endAt:-1}),a=t.at(0);if(t.some((t=>(0,n.toUpperCase)(e.name)===t.name)))throw r.default.Conflict("School year's name already existed!");if(a&&new Date(a?.endAt).getTime()>(new Date).getTime())throw r.default.BadRequest("Current school year has not finished, please comeback later!");let{error:o,value:i}=(0,s.validateNewSchoolYear)(e,a);if(o)throw r.default.BadRequest(o.message);return await new u.default(i).save()},l=async()=>{let e=await u.default.findOne({$and:[{startAt:{$lte:new Date}},{endAt:{$gte:new Date}}]});if(!e)throw r.default.NotFound("The new school year has not started yet, please come back later");return e},c=async(e,t)=>{let a=await u.default.find().sort({startAt:1,endAt:1}),{error:o,value:i}=(0,s.validateUpdateSchoolYearData)(e,t,a);if(o)throw r.default.BadRequest(o.message);if(await u.default.exists({_id:{$ne:e},name:(0,n.toUpperCase)(t.name)}))throw r.default.Conflict("School year name already existed!");return await u.default.findOneAndUpdate({_id:e},i,{new:!0,upsert:!1})}},4128:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(1921));"production"?.includes("production")&&process.env.SMS_VIRTUAL_PHONE;const n=async({to:e,text:t})=>await r.default.sms.send({from:"Vonage APIs",to:e,text:t}).then((e=>(console.log(e),e))).catch((e=>console.log(e)))},4051:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{createStudent:function(){return m},updateStudent:function(){return h},getStudentByClass:function(){return b},getDetailStudent:function(){return O},setStudentTransferSchool:function(){return g},setDropoutStudent:function(){return _},getStudentTransferSchool:function(){return w},getStudentDropout:function(){return j},markAttendanceStudent:function(){return E},dailyAttendanceList:function(){return v},attendanceOfStudentByMonth:function(){return S},getPolicyBeneficiary:function(){return T},getAttendanceAllClass:function(){return P},setStudentsAsGraduatedByClass:function(){return C}});const r=p(a(8931)),n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=y(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var s=n?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(r,u,s):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(1185)),u=a(1548),s=a(7790),o=p(a(3562)),i=p(a(2512)),d=a(530),l=a(254),c=a(6950),f=a(3019);function p(e){return e&&e.__esModule?e:{default:e}}function y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(y=function(e){return e?a:t})(e)}const m=async e=>{let{error:t}=(0,d.validateReqBodyStudent)(e);if(t)throw r.default.BadRequest(t.message);if(Array.isArray(e)){let t=await i.default.exists({code:{$in:e.map((e=>e.code))}});if(t)throw(0,r.default)(409,"Some students already exists ");return await i.default.insertMany(e)}if(await i.default.exists({code:e.code}))throw(0,r.default)(409,"Student already exists ");return await new i.default(e).save()},h=async(e,t)=>{let{error:a}=(0,d.validateUpdateReqBodyStudent)(t);if(a)throw r.default.BadRequest(a.message);if(!await i.default.exists({_id:e}))throw r.default.NotFound("Student does not exist!");return await i.default.findOneAndUpdate({_id:e},t,{new:!0})},b=async(e,t,a,n)=>{if(!["code","fullName","gender","dateOfBirth","class","parentsPhoneNumber","isPolicyBeneficiary","isGraduated"].includes(a))throw r.default.BadRequest("_sort can only belong to ['code','fullName','gender','dateOfBirth','class','parentsPhoneNumber','isPolicyBeneficiary','isGraduated']");return await i.default.find({class:e,dropoutDate:null,transferSchool:null}).sort({[a]:t}).select(n)},O=async e=>{if(!e||!n.default.Types.ObjectId.isValid(e))throw r.default.BadRequest("_id of the student is invalid");let t=await i.default.findOne({_id:e}).populate({path:"class",select:"className headTeacher"}),a=await(0,c.getStudentTranscript)(e);if(!t)throw r.default.NotFound("Student does not exist!");return{info:t,transcript:a}},g=async(e,t)=>{if(!e||!(0,n.isValidObjectId)(e))throw r.default.BadRequest("Invalid student ID");let a=new Date(t);if(isNaN(a.getTime()))throw r.default.BadRequest("The Date you passed is not in the correct Date data type");let u=await i.default.findOne({_id:e,transferSchool:null,dropoutDate:null});if(!u)throw r.default.NotFound("The student has transferred to another school or dropped out");let s=u.parents;return s&&await(0,f.deactivateParentsUser)(s),await i.default.findOneAndUpdate({_id:e},{transferSchool:t},{new:!0})},_=async(e,t)=>{if(!e)throw r.default.BadRequest("_id of the student is invalid");let a=new Date(t);if(isNaN(a.getTime()))throw r.default.BadRequest("The Date you passed is not in the correct Date data type");let n=await i.default.findOne({_id:e,transferSchool:null,dropoutDate:null});if(!n)throw r.default.NotFound("Student has transferred to another school or dropped out");return await(0,f.deactivateParentsUser)(n.parents),await i.default.findOneAndUpdate({_id:e},{dropoutDate:t},{new:!0})},w=async(e,t,a)=>await i.default.paginate("all"===e?{transferSchool:{$ne:null}}:{$expr:{$eq:[{$year:"$transferSchool"},e]}},{page:t,limit:a}),j=async(e,t,a)=>{let r={$expr:{$eq:[{$year:"$dropoutDate"},e]}};return"all"===e&&(r={dropoutDate:{$ne:null}}),await i.default.paginate(r,{page:t,limit:a})},E=async(e,t)=>{if(!t)throw(0,r.default)(u.HttpStatusCode.NO_CONTENT);if(!Array.isArray(t))throw(0,r.default)(400,"The list of absent students is not an array type");if(0===t.length)return{message:"Attendance has been saved!"};let a=[],o="";if(t.forEach((e=>{if(e.idStudent&&(0,n.isValidObjectId)(e.idStudent)||(o="idStudent of the student is invalid"),e.absent){let{error:t}=(0,d.validateAttendanceStudent)(e.absent);t&&(o+=" && "+t.message)}o.length>0&&a.push({id:e.idStudent,message:o})})),a.length>0)throw(0,r.default)(400,"The body data does not satisfy the validation",{error:a});let c=t.map((e=>e.idStudent)),f=await i.default.find({_id:{$in:c},class:e}),p=[];if(f.length!==c.length&&c.forEach((e=>{f.find((t=>t._id.toString()===e))||p.push(e)})),p.length>0)throw(0,r.default)(404,"This student does not exist in the class",{error:p});let y=[];if(f.forEach((e=>{let t=e.absentDays?.find((e=>0===(0,s.compareDates)(new Date,e?.date)));t&&y.push({id:e._id.toString(),name:e.fullName})})),y.length>0)throw(0,r.default)(409,"Today's attendance for the student already exists",{error:y});let m=await(0,l.getCurrentSchoolYear)(),h=t.map((e=>({updateOne:{filter:{_id:e.idStudent},update:{$push:{absentDays:{...e.absent,date:new Date,schoolYear:m._id}}}}})));return await i.default.bulkWrite(h),{message:"Attendance has been saved!"}},v=async(e,t)=>{if(!e||!n.default.Types.ObjectId.isValid(e))throw r.default.BadRequest("The provided idClass is invalid");let a=new Date(t);a.setDate(a.getDate()+1);let u=await i.default.find({absentDays:{$elemMatch:{date:{$gte:t,$lt:a}}},class:e}).lean();if(0===u.length)return{absent:0,students:[]};let s=u.map((e=>{let t=!0,a=u.find((t=>t._id.toString()===e._id.toString()));return t=!a,{...e,attendanceStatus:t}}));return{absent:u.length,students:s}},S=async(e,t,a)=>{let{info:{absentDays:r}}=await O(e),n=[];return r?.forEach((e=>{let r=new Date(e.date),u=r.getMonth()+1,s=r.getFullYear();u===t&&s===a&&n.push(e)})),n},T=async(e,t)=>await i.default.paginate({dropoutDate:null,transferSchool:null,isPolicyBeneficiary:!0},{page:e,limit:t,select:"-absentDays",sort:{class:"desc"}}),P=async(e,t,a)=>{let r=new Date(a);return r.setDate(a.getDate()+1),{...await i.default.paginate({absentDays:{$elemMatch:{date:{$gte:a,$lt:r}}}},{lean:!0,page:e,limit:t,sort:{class:"desc"},populate:{path:"class",select:"className"}}),classes:await o.default.find({}).sort({grade:"asc"}).lean().select("className")}},C=async e=>{let t=await o.default.findOne({_id:e});if(!t)throw r.default.NotFound("Invalid class");if(5!=t.grade)throw r.default.BadRequest("Only students is in grade 5 is qualified to be marked as graduated !");let a=await(0,l.getCurrentSchoolYear)();await(0,c.selectTranscriptAllSubjectByClass)(t._id,a._id),await i.default.updateMany({},{isGraduated:!0,class:null},{new:!0})}},4875:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createStudentRemark",{enumerable:!0,get:function(){return d}});const r=i(a(8931)),n=i(a(2512)),u=i(a(2544)),s=a(641),o=a(254);function i(e){return e&&e.__esModule?e:{default:e}}const d=async(e,t)=>{let a=await(0,o.getCurrentSchoolYear)();if(await u.default.findOne({student:e.student,schoolYear:a._id}))throw r.default.Conflict("Remark for this student in current school year already existed!");let i=await n.default.findOne({_id:e.student}).populate({path:"class",select:"_id className headTeacher",match:{headTeacher:t}});if(!i?.class)throw r.default.BadRequest("Only head teacher can remark conduct for this student !");let d={...e,schoolYear:a._id?.toString(),remarkedBy:t},{error:l,value:c}=(0,s.validateNewStudentRemark)(d);if(l)throw r.default.BadRequest(l.message);return await new u.default(c).save()}},7696:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{getAllSubjects:function(){return d},getOneSubject:function(){return l},createNewSubject:function(){return c},updateSubject:function(){return f},deleteSoft:function(){return p},deleteForce:function(){return y},getTrash:function(){return m},restore:function(){return h}});const r=i(a(8931)),n=a(1185),u=i(a(8501)),s=i(a(3664)),o=a(5840);function i(e){return e&&e.__esModule?e:{default:e}}const d=async()=>await s.default.find().sort({subjectName:1}),l=async e=>await s.default.findById(e),c=async e=>{let{error:t}=(0,o.validateSubjectRequestBody)(e);if(t)throw r.default.BadRequest(t.message);if(await s.default.exists({subjectCode:e.subjectCode.toUpperCase()}))throw r.default.Conflict("Subject already exists");return await new s.default(e).save()},f=async(e,t)=>{if(!e)throw r.default.BadRequest("Missing parameter");let{error:a,value:u}=(0,o.validateSubjectUpdateBody)(t);if(a)throw r.default.BadRequest(a.message);if(!(0,n.isValidObjectId)(e))throw r.default.BadRequest("Invalid subject ID!");if(!await s.default.exists({_id:e}))throw r.default.NotFound("Subject does not exist");if(await s.default.exists({subjectCode:t.subjectCode?.toUpperCase()}))throw r.default.Conflict("Subject code already existed!");return await s.default.findOneAndUpdate({_id:e},u,{new:!0})},p=async e=>{if(await u.default.exists({subject:e}))throw r.default.Conflict("Cannot delete this subject due to existing learning material of this subject !");if(!(0,n.isValidObjectId)(e))throw r.default.BadRequest("_id of the subject is invalid");return await s.default.delete({_id:e})},y=async e=>{if(await u.default.exists({subject:e}))throw r.default.Conflict("Cannot delete this subject due to existing learning material of this subject !");if(!(0,n.isValidObjectId)(e))throw r.default.BadRequest("_id of the subject is invalid");return await s.default.deleteOne({_id:e})},m=async()=>await s.default.findWithDeleted({deleted:!0}),h=async e=>{if(!(0,n.isValidObjectId)(e))throw r.default.BadRequest("Invalid subject ID !");return await s.default.restore({_id:e}),{message:"Subject have been restored",statusCode:201}}},6950:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{newScoreList:function(){return p},newScore:function(){return y},selectSubjectTranscriptByClass:function(){return m},getStudentTranscript:function(){return h},selectTranscriptAllSubjectByClass:function(){return b}});const r=c(a(8931)),n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=f(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var s=n?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(r,u,s):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(1185)),u=c(a(3562)),s=c(a(2512)),o=c(a(3664)),i=c(a(4729)),d=a(5690),l=a(254);function c(e){return e&&e.__esModule?e:{default:e}}function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(f=function(e){return e?a:t})(e)}const p=async(e,t,a)=>{if(!(0,n.isValidObjectId)(t)||!(0,n.isValidObjectId)(e))throw r.default.BadRequest("classId or subjectId is not in the correct ObjectId format");if(!Array.isArray(a)||0===a.length)throw r.default.BadRequest("Body data must be an array and cannot be empty!");let[c,f,p,y]=await Promise.all([(0,l.getCurrentSchoolYear)(),u.default.exists({_id:t}),o.default.findOne({_id:e}),s.default.exists({$and:[{_id:{$in:a.map((e=>e.student))}},{class:t}]})]);if(!f)throw r.default.NotFound("Class does not exist or has been deleted!");if(!p)throw r.default.NotFound("Subject does not exist or has been deleted!");if(!y)throw r.default.Conflict("Some students do not exist in this class !");let{error:m,value:h}=(0,d.validateSubjectTranscript)(a,p);if(m)throw r.default.BadRequest(m.message);let b=h.map((t=>({updateOne:{filter:{student:t.student,subject:e,schoolYear:c},update:t,upsert:!0}})));return await i.default.bulkWrite(b)},y=async(e,t,a)=>{if(!(0,n.isValidObjectId)(t)||!(0,n.isValidObjectId)(e))throw r.default.BadRequest("studentId or subjectId is not in the correct ObjectId format");if(!a||0===Object.keys(a).length)throw(0,r.default)(304);let u=await(0,l.getCurrentSchoolYear)(),c=s.default.findOne({_id:t}),f=o.default.findOne({_id:e}),[p,y]=await Promise.all([c,f]);if(!p)throw r.default.NotFound("Student does not exist or has been deleted!");if(!y)throw r.default.NotFound("Subject does not exist or has been deleted!");let{error:m}=(0,d.validateSubjectTranscriptOne)(a);if(m)throw r.default.BadRequest(m.message);let h=await i.default.findOne({student:t,subject:e,schoolYear:u._id});return h?await i.default.findOneAndUpdate({_id:h._id},a,{new:!0}):await new i.default({...a,student:t,subject:e,schoolYear:u._id}).save()},m=async(e,t)=>{if(!(e&&t&&(0,n.isValidObjectId)(e)&&(0,n.isValidObjectId)(t)))throw r.default.BadRequest("classId or subjectId is not in the correct ObjectId format");let a=await(0,l.getCurrentSchoolYear)(),u=await s.default.find({class:e,dropoutDate:null,transferSchool:null}).select("_id").lean();return await i.default.find({student:{$in:u},schoolYear:a._id,subject:t}).populate({path:"student",select:"-absentDays"}).populate({path:"schoolYear",select:"startAt endAt"}).select("-_id")},h=async e=>{if(!e||!(0,n.isValidObjectId)(e))throw r.default.BadRequest("id student is not in the correct ObjectId format");if(!await s.default.findOne({_id:e,dropoutDate:null,transferSchool:null}))throw r.default.NotFound("Student does not exist");let t=await(0,l.getCurrentSchoolYear)();return(await i.default.aggregate().match({student:new n.default.Types.ObjectId(e),schoolYear:t._id}).lookup({from:"students",localField:"student",foreignField:"_id",as:"student",pipeline:[{$project:{_id:1,fullName:1}}]}).unwind("$student").lookup({from:"subjects",localField:"subject",foreignField:"_id",as:"subject",pipeline:[{$project:{_id:1,subjectName:1}}]}).unwind("$subject").group({_id:"$student",student:{$first:"$student"},transcript:{$push:{subject:"$subject",firstSemester:"$firstSemester",secondSemester:"$secondSemester",isPassed:"$isPassed"}}}).project({_id:0,subject:1,transcript:1,student:1})).at(0)},b=async(e,t)=>{if(!(0,n.isValidObjectId)(e))throw r.default.BadRequest("Invalid class ID");let a=await s.default.find({class:e,dropoutDate:null,transferSchool:null}).select("_id").lean(),u=await i.default.aggregate().match({student:{$in:a.map((e=>e._id))},schoolYear:t}).lookup({from:"subjects",foreignField:"_id",localField:"subject",as:"subject",pipeline:[{$project:{subjectName:1}}]}).unwind("$subject").lookup({from:"students",foreignField:"_id",localField:"student",as:"student",pipeline:[{$project:{_id:1,fullName:1,class:1}}]}).unwind("$student").group({_id:"$student",student:{$first:"$student"},transcript:{$push:{subject:"$subject",firstSemester:"$firstSemester",secondSemester:"$secondSemester",isPassed:"$isPassed"}}}).sort({student:1}).project({_id:0,student:1,transcript:1});return u}},1177:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{createTimetable:function(){return n},updateTimetable:function(){return u},deleteTimeTable:function(){return s},getTimetableByClass:function(){return o},getTeacherTimeTableByClass:function(){return i}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(9374)),n=async e=>await new r.default(e).save(),u=async({classId:e,payload:t})=>await r.default.findOneAndUpdate({class:e},t,{new:!0}),s=async e=>await r.default.findOneAndDelete({class:e}),o=async e=>await r.default.findOne({class:e}),i=async(e,t)=>{let a=await r.default.findOne({class:t,$or:[{"schedule.monday":{$elemMatch:{teacher:e}},"schedule.tuesday":{$elemMatch:{teacher:e}},"schedule.wednesday":{$elemMatch:{teacher:e}},"schedule.thursday":{$elemMatch:{teacher:e}},"schedule.friday":{$elemMatch:{teacher:e}},"schedule.saturday":{$elemMatch:{teacher:e}}}]}).transform((t=>t?Object.entries(t?.schedule).map((t=>{let a=t[0];return t[1].map((e=>({...e=e.toObject(),dayOfWeek:a}))).filter((t=>t.teacher._id.toString()===e))})).flat():t));return a}},3019:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{createUser:function(){return c},updateUserInfo:function(){return f},updateTeacherInfo:function(){return p},updateParentsUserInfo:function(){return y},getUserDetails:function(){return m},changePassword:function(){return h},getTeacherUsersByStatus:function(){return b},deactivateTeacherUser:function(){return O},getParentsUserByClass:function(){return g},searchParents:function(){return _},updateUserPicture:function(){return w},deactivateParentsUser:function(){return j}});const r=a(7096),n=l(a(8931)),u=l(a(9939)),s=l(a(7130)),o=a(6880),i=a(7822),d=a(5550);function l(e){return e&&e.__esModule?e:{default:e}}const c=async e=>{if(Array.isArray(e)&&e.every((e=>e.role===o.UserRoleEnum.PARENTS))){if(await s.default.exists({$or:[{email:{$in:e.map((e=>e.email))}},{phone:{$in:e.map((e=>e.phone))}}]}))throw n.default.Conflict("Parents's phone number or email cannot be duplicated!");return await s.default.insertMany(e)}if(e.role===o.UserRoleEnum.TEACHER){if(await s.default.findOne({$or:[{email:e.email,phone:e.phone}]}))throw n.default.BadRequest("Teacher's email or phone number cannot be duplicated!");return await new s.default(e).save()}},f=async(e,t)=>{if(await s.default.findOne({_id:{$ne:e},$or:[{phone:t.phone},{email:t.email}]}))throw n.default.Conflict("User having this email or phone number already existed !");return await s.default.findOneAndUpdate({_id:e._id},t,{new:!0})},p=async(e,t)=>{if(await s.default.findOne({_id:{$ne:e},$or:[{phone:t.phone},{email:t.email}]}))throw n.default.Conflict("User having this email or phone number already existed !");return await s.default.findOneAndUpdate({_id:e,role:o.UserRoleEnum.TEACHER},t,{new:!0}).lean()},y=async(e,t)=>{if(await s.default.findOne({_id:{$ne:e},$or:[{phone:t.phone},{email:t.email}]}))throw n.default.Conflict("User having this email or phone number already existed !");return await s.default.findOneAndUpdate({_id:e,role:o.UserRoleEnum.PARENTS},t,{new:!0}).lean()},m=async e=>await s.default.findOne({_id:e}).lean(),h=async(e,t)=>{let a=(0,r.hashSync)(t,(0,r.genSaltSync)(+process.env.SALT_ROUND));return await s.default.findOneAndUpdate({_id:e},{password:a},{new:!0})},b=async e=>{switch(e){case"inactive":return await s.default.find({role:o.UserRoleEnum.TEACHER,isVerified:!1});case"in_working":return await s.default.find({role:o.UserRoleEnum.TEACHER,employmentStatus:!0});case"quited":return await s.default.findWithDeleted({role:o.UserRoleEnum.TEACHER,deleted:!0,isVerified:!0,employmentStatus:!1});default:return await s.default.findWithDeleted({role:o.UserRoleEnum.TEACHER})}},O=async e=>await s.default.findOneAndUpdate({_id:e,role:o.UserRoleEnum.TEACHER},{employmentStatus:!1,deleted:!0},{new:!0}).lean(),g=async e=>{let t=await s.default.find({role:o.UserRoleEnum.PARENTS}).populate({path:"children",select:"fullName class -parents",match:{class:e},populate:{path:"class",select:"className"}}).lean().transform((e=>e.filter((e=>e.children.length>0))));return t},_=async e=>{let t=RegExp(`^${e}`,"gi");return await s.default.find({$or:[{phone:t,role:o.UserRoleEnum.PARENTS},{displayName:(0,u.default)(e),role:o.UserRoleEnum.PARENTS},{email:t,role:o.UserRoleEnum.PARENTS}]}).lean()},w=async(e,t)=>await s.default.findOneAndUpdate({_id:e._id},{picture:t},{new:!0}),j=async e=>{if(Array.isArray(e)){let t=await s.default.updateMany({_id:{$in:e}},{deleted:!0},{new:!0}),a=e.map((e=>new Promise((t=>(0,i.sendMail)((0,d.getDeactivateUserEmail)(e)).catch((e=>t(e)))))));return await Promise.all(a),t}let t=await s.default.findOneAndUpdate({_id:e._id},{deleted:!0},{new:!0});return await(0,i.sendMail)((0,d.getDeactivateUserEmail)(e)),t}},6813:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{validateClassData:function(){return n},validateArrayOfClassData:function(){return u},validateClassEditData:function(){return s}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(8506)),n=e=>{let t=RegExp(`^${e.grade}[a-zA-Z]$`);return r.default.object({className:r.default.string().required().pattern(t),headTeacher:r.default.string().required(),grade:r.default.number().required().valid(1,2,3,4,5)}).validate(e)},u=e=>{let t=RegExp(`^${e.grade}[a-zA-Z]$`);return r.default.array().items(r.default.object({className:r.default.string().required().pattern(t),headTeacher:r.default.string().required(),grade:r.default.number().required().valid(1,2,3,4,5)})).validate(e)},s=e=>{let t=e.grade?RegExp(`^${e.grade}[a-zA-Z]$`):/^[1-5][a-zA-Z]$/;return r.default.object({className:r.default.string().required().pattern(t).optional(),headTeacher:r.default.string().required().optional(),grade:r.default.number().required().valid(1,2,3,4,5).optional()}).validate(e)}},7848:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"checkValidMimeType",{enumerable:!0,get:function(){return n}});const r=a(6468),n=e=>Object.values(r.AllowedMimeType).includes(e.mimetype)},8719:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"validatePermissionData",{enumerable:!0,get:function(){return s}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(8506)),n=a(8324),u=a(6880),s=e=>r.default.object({role:r.default.string().valid(...Object.values(u.UserRoleEnum)).required(),permissions:r.default.array().items(r.default.object({type:r.default.string().required(),allowedActions:r.default.array().items(r.default.string().valid(...Object.values(n.PermissionActionsEnum)).required())})).default([])}).validate(e)},4361:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{validateNewSchoolYear:function(){return n},validateUpdateSchoolYearData:function(){return u}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(8506)),n=(e,t)=>r.default.object({name:r.default.string().required(),startAt:t?r.default.date().greater(t.endAt):r.default.date().required(),endAt:r.default.date().greater(r.default.ref("startAt")).required()}).validate(e),u=(e,t,a)=>{let n=r.default.object({name:r.default.string().optional(),startAt:r.default.date().optional(),endAt:r.default.date().greater(r.default.ref("startAt")).optional()}),u=a.findIndex((t=>t._id.toString()===e)),s=a.at(u-1),o=a.at(u+1);return(0===u?n.keys({endAt:r.default.date().greater(r.default.ref("startAt")).less(o?.startAt).optional()}):u===a.length-1?n.keys({startAt:r.default.date().greater(s?.endAt).optional(),endAt:r.default.date().greater(r.default.ref("startAt")).optional()}):-1===u?n:n.keys({startAt:r.default.date().greater(s?.endAt).optional(),endAt:r.default.date().greater(r.default.ref("startAt")).less(o?.startAt).optional()})).validate(t)}},4581:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"checkIsValidSortObject",{enumerable:!0,get:function(){return n}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(8506)),n=e=>r.default.object({_sort:r.default.string().required(),_order:r.default.string().required()}).validate(e)},530:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{validateReqBodyStudent:function(){return u},validateAttendanceStudent:function(){return s},validateUpdateReqBodyStudent:function(){return o}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(8506)),n=a(6880),u=e=>{let t=r.default.object({class:r.default.string().required(),code:r.default.string().required(),fullName:r.default.string().required().min(6).max(100),gender:r.default.string().valid(...Object.values(n.UserGenderEnum)).required(),dateOfBirth:r.default.date().required(),parents:r.default.string().required(),isPolicyBeneficiary:r.default.bool().optional(),isGraduated:r.default.bool().optional()}),a=r.default.array().items(t);return Array.isArray(e)?a.validate(e):t.validate(e)},s=e=>r.default.object({hasPermision:r.default.bool().optional(),reason:r.default.string().min(8).max(256).optional()}).validate(e),o=e=>r.default.object({class:r.default.string().required().optional(),code:r.default.string().required().optional(),fullName:r.default.string().required().min(6).max(100).optional(),gender:r.default.string().valid(...Object.values(n.UserGenderEnum)).required().optional(),dateOfBirth:r.default.date().required().optional(),parents:r.default.string().required().optional(),isPolicyBeneficiary:r.default.bool().optional(),isGraduated:r.default.bool().optional()}).validate(e)},641:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"validateNewStudentRemark",{enumerable:!0,get:function(){return u}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(8506)),n=a(3),u=e=>r.default.object({student:r.default.string().required(),schoolYear:r.default.string().required(),conduct:r.default.string().valid(...Object.values(n.StudentQualityEnum)).required(),proficiency:r.default.string().valid(...Object.values(n.StudentQualityEnum)).required(),remark:r.default.string().required(),remarkedBy:r.default.string().required()}).validate(e)},5840:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{validateSubjectRequestBody:function(){return u},validateSubjectUpdateBody:function(){return s}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(8506)),n=a(7790),u=e=>r.default.object({subjectName:r.default.string().trim().required().min(3).max(50),subjectCode:r.default.string().uppercase().trim().required(),isMainSubject:r.default.boolean().required(),appliedForGrades:r.default.array().items(r.default.number().valid(1,2,3,4,5)).default([1,2,3,4,5]),isElectiveSubject:r.default.boolean().required()}).validate(e),s=e=>r.default.object({subjectName:r.default.string().custom(n.toCapitalize,"Capitalize string value").required().min(3).max(50).optional(),subjectCode:r.default.string().uppercase().trim().optional(),isMainSubject:r.default.boolean().optional(),appliedForGrades:r.default.array().items(r.default.number().valid(1,2,3,4,5)).optional(),isElectiveSubject:r.default.boolean().optional()}).validate(e)},5690:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{validateSubjectTranscript:function(){return n},validateSubjectTranscriptOne:function(){return u}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(8506)),n=(e,t)=>{let a=r.default.object({student:r.default.string().required()}),n=r.default.array().items(a);return a=t.isMainSubject?a.keys({firstSemester:r.default.object({midtermTest:r.default.number().required().min(0).max(10),finalTest:r.default.number().required().min(0).max(10)}).optional(),secondSemester:r.default.object({midtermTest:r.default.number().required().min(0).max(10),finalTest:r.default.number().required().min(0).max(10)}).optional()}):a.keys({isPassed:r.default.boolean().required()}),Array.isArray(e)?n.validate(e):a.validate(e)},u=e=>r.default.object({firstSemester:r.default.object({midtermTest:r.default.number().required().min(0).max(10),finalTest:r.default.number().required().min(0).max(10)}).optional(),secondSemester:r.default.object({midtermTest:r.default.number().required().min(0).max(10),finalTest:r.default.number().required().min(0).max(10)}).optional()}).validate(e)},9868:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{validateNewTimeTable:function(){return u},validateUpdateTimeTablePayload:function(){return s}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(8506)),n=r.default.object({period:r.default.number().integer().valid(1,2,3,4,5,6,7,8,9,10).required(),subject:r.default.string().required(),teacher:r.default.string().required()}),u=e=>r.default.object({class:r.default.string().required(),schedule:r.default.object({monday:r.default.array().unique("period").items(n).required(),tuesday:r.default.array().unique("period").items(n).required(),wednesday:r.default.array().unique("period").items(n).required(),thursday:r.default.array().unique("period").items(n).required(),friday:r.default.array().unique("period").items(n).required(),saturday:r.default.array().unique("period").items(n).required()}).required()}).validate(e),s=e=>r.default.object({class:r.default.string(),schedule:r.default.object({monday:r.default.array().unique("period").items(n).required(),tuesday:r.default.array().unique("period").items(n).required(),wednesday:r.default.array().unique("period").items(n).required(),thursday:r.default.array().unique("period").items(n).required(),friday:r.default.array().unique("period").items(n).required(),saturday:r.default.array().unique("period").items(n).required()}).required()}).validate(e)},3326:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{validateSigninData:function(){return s},validateNewTeacherData:function(){return o},validateNewParentsData:function(){return i},validateUpdateUserData:function(){return d}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(8506)),n=a(6880),u=a(7790),s=e=>r.default.object({phoneOrEmail:r.default.alternatives().try(r.default.string().lowercase().email({minDomainSegments:2,tlds:{allow:["com"]}}),r.default.string().alphanum().min(3).max(30)).required().error(Error("Invalid email or userName")),password:r.default.string().min(6).max(32).required()}).validate(e),o=e=>r.default.object({email:r.default.string().lowercase().email({tlds:{allow:!0}}).regex(/^[\w.+\-]+@gmail\.com$/,{name:"email"}).required().messages({"object.regex":"Email must be a valid Gmail address !"}),password:r.default.string().min(6).max(24),displayName:r.default.string().custom(u.toCapitalize).required(),address:r.default.string().required(),dateOfBirth:r.default.date().required(),phone:r.default.string().pattern(/^\d{10,11}$/,{name:"phone number"}).required(),gender:r.default.string().required().valid(...Object.values(n.UserGenderEnum)),eduBackground:r.default.object({universityName:r.default.string().custom(u.toCapitalize).required(),graduatedAt:r.default.date().required(),qualification:r.default.string().custom(u.toCapitalize).required()})}).validate(e),i=e=>{let t=r.default.object({email:r.default.string().lowercase().email().regex(/^[\w.+\-]+@gmail\.com$/,{name:"email"}).required().messages({"string.pattern.base":"User email must be a valid Gmail address !"}),phone:r.default.string().pattern(/^\d{10,11}$/,{name:"phone number"}).required(),displayName:r.default.string().custom(u.toCapitalize).required(),address:r.default.string().required(),dateOfBirth:r.default.date().required(),gender:r.default.string().required()}),a=r.default.array().items(t).unique(((e,t)=>e.phone===t.phone)).unique(((e,t)=>e.email.toLowerCase()===t.email.toLowerCase()));return Array.isArray(e)?a.validate(e):t.validate(e)},d=e=>r.default.object({email:r.default.string().email().lowercase().regex(/^[\w.+\-]+@gmail\.com$/,{name:"email"}).optional().messages({"string.pattern.base":"User email must be a valid Gmail address !"}),address:r.default.string().optional(),displayName:r.default.string().optional(),dateOfBirth:r.default.date().optional(),phone:r.default.string().pattern(/^\d{10,11}$/,{name:"phone number"}).optional(),gender:r.default.string().valid(...Object.values(n.UserGenderEnum)).optional(),eduBackground:r.default.object({universityName:r.default.string().required(),graduatedAt:r.default.date().required(),qualification:r.default.string().required()}).optional()}).validate(e)},4559:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return g}});const r=m(a(9710)),n=m(a(3582));a(1081);const u=m(a(6860)),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=h(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var s=n?Object.getOwnPropertyDescriptor(e,u):null;s&&(s.get||s.set)?Object.defineProperty(r,u,s):r[u]=e[u]}return r.default=e,a&&a.set(e,r),r}(a(6508)),o=m(a(9470)),i=m(a(3511));a(4235),a(3671);const d=m(a(9948)),l=m(a(8664)),c=m(a(1017)),f=m(a(2852)),p=m(a(2057)),y=a(1548);function m(e){return e&&e.__esModule?e:{default:e}}function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(h=function(e){return e?a:t})(e)}const b=c.default.join(__dirname,"..");c.default.join(b,"src");const O=(0,u.default)();O.use(u.default.json()),O.use((0,o.default)("tiny")),O.use((0,n.default)({origin:["http://localhost:3000","https://fe-education-testing.vercel.app"],credentials:!0,methods:["GET","POST","PATCH","PUT","DELETE"],preflightContinue:!0})),O.use((0,r.default)()),O.use((0,s.default)({saveUninitialized:!1,secret:p.default.KEY_SESSION,store:new s.MemoryStore,resave:!0})),O.use(i.default.initialize()),O.use(i.default.session()),O.use("/api",f.default),O.use("/api/document",d.default.serve,d.default.setup(l.default)),O.get("/",((e,t)=>t.json({message:"Server now is running.",status:y.HttpStatusCode.OK})));const g=O},2057:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}}),a(1081);const r="production"?.includes("production"),n={PORT:process.env.PORT||3001,KEY_SESSION:process.env.KEY_SESSION,CLIENT_URL:r?process.env.MAIN_FRONTEND_URL:process.env.LOCAL_FRONTEND_URL,MONGO_URI:r?process.env.MAIN_DB_URI:process.env.TEST_DB_URI,TAILWIND_CDN:"https://cdn.tailwindcss.com",BOOTSTRAP_ICONS_CDN:"https://cdn.tailwindcss.com"}},582:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{oauth2Client:function(){return d},baseDownloadUrl:function(){return c},drive:function(){return l}});const r=a(9993);a(1081);const{GOOGLE_CLIENT_ID:n,GOOGLE_CLIENT_SECRET:u,GOOGLE_API_REFRESH_TOKEN:s,REDIRECT_URI:o,GOOGLE_API_KEY:i}=process.env,d=new r.google.auth.OAuth2(n,u,o);d.setCredentials({refresh_token:s}),d.getAccessToken();const l=r.google.drive({version:"v3",auth:d}),c="https://drive.google.com/uc?export=download&id="},5103:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}}),a(1081);const r=function(e){return e&&e.__esModule?e:{default:e}}(a(5184)).default.createTransport({service:"gmail",port:465,auth:{user:process.env.AUTH_EMAIL,pass:process.env.AUTH_PASSWORD},tls:{rejectUnauthorized:!1}})},2109:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"redisOptions",{enumerable:!0,get:function(){return r}}),a(1081);const r={password:process.env.REDIS_PASSWORD,socket:{host:process.env.REDIS_HOST,port:+process.env.REDIS_PORT,noDelay:!1,keepAlive:-1,connectionTimeOut:5e3}}},1921:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return u}}),a(1081);const r=a(7601),n=function(e){return e&&e.__esModule?e:{default:e}}(a(1017)),u=new r.Vonage({apiKey:process.env.SMS_API_KEY,apiSecret:process.env.SMS_API_SECRET,applicationId:process.env.SMS_API_APP_ID,privateKey:n.default.resolve("/private.key")})},1548:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"HttpStatusCode",{enumerable:!0,get:function(){return a}}),function(e){e[e.CONTINUE=100]="CONTINUE",e[e.SWITCHING_PROTOCOLS=101]="SWITCHING_PROTOCOLS",e[e.PROCESSING=102]="PROCESSING",e[e.OK=200]="OK",e[e.CREATED=201]="CREATED",e[e.ACCEPTED=202]="ACCEPTED",e[e.NON_AUTHORITATIVE_INFORMATION=203]="NON_AUTHORITATIVE_INFORMATION",e[e.NO_CONTENT=204]="NO_CONTENT",e[e.RESET_CONTENT=205]="RESET_CONTENT",e[e.PARTIAL_CONTENT=206]="PARTIAL_CONTENT",e[e.MULTI_STATUS=207]="MULTI_STATUS",e[e.MULTIPLE_CHOICES=300]="MULTIPLE_CHOICES",e[e.MOVED_PERMANENTLY=301]="MOVED_PERMANENTLY",e[e.MOVED_TEMPORARILY=302]="MOVED_TEMPORARILY",e[e.SEE_OTHER=303]="SEE_OTHER",e[e.NOT_MODIFIED=304]="NOT_MODIFIED",e[e.USE_PROXY=305]="USE_PROXY",e[e.TEMPORARY_REDIRECT=307]="TEMPORARY_REDIRECT",e[e.PERMANENT_REDIRECT=308]="PERMANENT_REDIRECT",e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.PAYMENT_REQUIRED=402]="PAYMENT_REQUIRED",e[e.FORBIDDEN=403]="FORBIDDEN",e[e.NOT_FOUND=404]="NOT_FOUND",e[e.METHOD_NOT_ALLOWED=405]="METHOD_NOT_ALLOWED",e[e.NOT_ACCEPTABLE=406]="NOT_ACCEPTABLE",e[e.PROXY_AUTHENTICATION_REQUIRED=407]="PROXY_AUTHENTICATION_REQUIRED",e[e.REQUEST_TIMEOUT=408]="REQUEST_TIMEOUT",e[e.CONFLICT=409]="CONFLICT",e[e.GONE=410]="GONE",e[e.LENGTH_REQUIRED=411]="LENGTH_REQUIRED",e[e.PRECONDITION_FAILED=412]="PRECONDITION_FAILED",e[e.REQUEST_TOO_LONG=413]="REQUEST_TOO_LONG",e[e.REQUEST_URI_TOO_LONG=414]="REQUEST_URI_TOO_LONG",e[e.UNSUPPORTED_MEDIA_TYPE=415]="UNSUPPORTED_MEDIA_TYPE",e[e.REQUESTED_RANGE_NOT_SATISFIABLE=416]="REQUESTED_RANGE_NOT_SATISFIABLE",e[e.EXPECTATION_FAILED=417]="EXPECTATION_FAILED",e[e.IM_A_TEAPOT=418]="IM_A_TEAPOT",e[e.INSUFFICIENT_SPACE_ON_RESOURCE=419]="INSUFFICIENT_SPACE_ON_RESOURCE",e[e.METHOD_FAILURE=420]="METHOD_FAILURE",e[e.MISDIRECTED_REQUEST=421]="MISDIRECTED_REQUEST",e[e.UNPROCESSABLE_ENTITY=422]="UNPROCESSABLE_ENTITY",e[e.LOCKED=423]="LOCKED",e[e.FAILED_DEPENDENCY=424]="FAILED_DEPENDENCY",e[e.PRECONDITION_REQUIRED=428]="PRECONDITION_REQUIRED",e[e.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",e[e.REQUEST_HEADER_FIELDS_TOO_LARGE=431]="REQUEST_HEADER_FIELDS_TOO_LARGE",e[e.UNAVAILABLE_FOR_LEGAL_REASONS=451]="UNAVAILABLE_FOR_LEGAL_REASONS",e[e.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",e[e.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",e[e.BAD_GATEWAY=502]="BAD_GATEWAY",e[e.SERVICE_UNAVAILABLE=503]="SERVICE_UNAVAILABLE",e[e.GATEWAY_TIMEOUT=504]="GATEWAY_TIMEOUT",e[e.HTTP_VERSION_NOT_SUPPORTED=505]="HTTP_VERSION_NOT_SUPPORTED",e[e.INSUFFICIENT_STORAGE=507]="INSUFFICIENT_STORAGE",e[e.NETWORK_AUTHENTICATION_REQUIRED=511]="NETWORK_AUTHENTICATION_REQUIRED"}(a||(a={}))},8664:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});const r=(0,function(e){return e&&e.__esModule?e:{default:e}}(a(7777)).default)({definition:{openapi:"3.0.0",basePath:"/api",servers:[{url:"http://localhost:3001/api",description:"Development API"},{url:"https://education-management-backend.vercel.app",description:"Production API"}],info:{title:"APIs Documentation",version:"1.0.0",description:"Documentation for all endpoints"}},apis:["src/docs/**/*.yaml"]})},8438:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(1185));a(1081);const n=async()=>{try{r.default.set("strictQuery",!1);let e="production"?.includes("production");e?console.log("[INFO] ::: Environment -> Production"):console.log("[INFO] ::: Environment -> Development");let t=await r.default.connect(process.env.DB_URI);return console.log("[SUCCESS] ::: Connected to database"),t}catch(e){console.log("[ERROR] ::: ",e.message)}}},9123:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}}),a(1081);const r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=u(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=n?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,a&&a.set(e,r),r}(a(7773)),n=a(2109);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(u=function(e){return e?a:t})(e)}const s=r.createClient(n.redisOptions);s.connect().then((()=>{console.log("[SUCCESS] ::: Connected to Redis")})).catch((e=>{console.log("[ERROR] ::: ",e.message)})),s.on("error",(e=>{console.log(e.message)}));const o=s},2076:(e,t)=>{function a(e){return"84"+e.slice(1)}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}})},5550:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{getVerificationEmailTemplate:function(){return u},getDeactivateUserEmail:function(){return s}});const r=function(e){return e&&e.__esModule?e:{default:e}}(a(2245)),n=a(2407),u=({redirectDomain:e,user:t,token:a})=>({to:t.email,subject:"Kích hoạt tài khoản đăng nhập hệ thống quản lý giáo dục trường TH Bột Xuyên",html:`\n\t\t\t<div>\n\t\t\t\t<p>\n\t\t\t\t\tThân gửi ${t.displayName}!\n\t\t\t\t\t<p>\n\t\t\t\t\t\tNgười dùng nhận được mail vui lòng click vào <a href='${e+"/api/auth/verify-account"+(0,n.paramsStringify)({_role:t.role,_token:a})}'>link</a> này để xác thực tài khoản.\n\t\t\t\t\t</p>\n\t\t\t\t\t<i>Lưu ý: Mail xác thực này có hiệu lực trong vòng 7 ngày</i>\n\t\t\t\t</p>\n\t\t\t\t<hr>\n\t\t\t\t<p>\n\t\t\t\t\t<span style="display: block">Trân trọng!</span>\n\t\t\t\t\t<i>Tiểu học Bột Xuyên</i>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t\t\t`}),s=e=>({to:e.email,subject:"Tiểu học Bột Xuyên thông báo vô hiệu hóa tài khoản người dùng.",html:`\n       <h4>Trường tiểu Học Bột Xuyên thông báo.</h4>\n       <p>\n         Tài khoản của bạn đã bị vô hiệu hóa kể từ ngày ${(0,r.default)().format("DD/MM/YYYY")}.\n         Nếu có bất kỳ thắc mắc vui lòng liên hệ cho nhà trường theo số điện thoại 0xxx.xxx.xxx\n         <hr style="width: 100%; height: 0.5px; background: #d1d5db">\n         <i>Lưu ý: Đây là mail tự động, vui lòng không trả lời mail này.</i>\n         <br>\n         <b>Trân trọng</b>\n         <br>\n         <i>Trường tiểu học Bột Xuyên</i>\n       </p>\n      `})},1261:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}});const a=()=>Math.floor(1e6*Math.random()).toString()},2407:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{paramsStringify:function(){return n},multiFieldSortObjectParser:function(){return u}});const r=a(4581),n=e=>e?"?"+Object.keys(e).map((t=>t+"="+encodeURIComponent(e[t]))).join("&"):"",u=e=>{try{if(!e)return;let{error:t}=(0,r.checkIsValidSortObject)(e);if(console.log(t?.message),t)return;let a=e._sort.split(","),n=e._order.split(",");return a.reduce(((e,t,a)=>(e[t]=n[a],e)),{})}catch(e){throw e}}},7790:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{compareDates:function(){return a},formatDate:function(){return r},toCapitalize:function(){return n},toUpperCase:function(){return u}});const a=(e,t)=>{try{let a=new Date(r(e)),n=new Date(r(t));return a.getTime()===n.getTime()?0:a.getTime()>n.getTime()?1:-1}catch(e){throw e}},r=e=>{try{let t=""+(e.getMonth()+1),a=""+e.getDate(),r=e.getFullYear();return t.length<2&&(t="0"+t),a.length<2&&(a="0"+a),[t,a,r].join("-")}catch(e){throw e}},n=e=>{if(!e||"string"!=typeof e)return;let t=(e=e.trim().replace(/\s+/g," ")).split(" ").map((e=>e.at(0).toUpperCase()+e.slice(1).toLowerCase())).join(" ");return t},u=e=>{if(e&&"string"==typeof e)return e.trim().replace(/\s+/g," ").toUpperCase()}},2383:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});const r=a(2116),n=e=>(t,a)=>Promise.resolve(e(t,a)).catch((e=>{let t=new r.HttpException(e);return a.status(t.statusCode).json(t)}))},9939:(e,t)=>{function a(e){return(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g,"a")).replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g,"e")).replace(/ì|í|ị|ỉ|ĩ/g,"i")).replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g,"o")).replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u")).replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y")).replace(/đ/g,"d")).replace(/À|Á|Ạ|Ả|Ã|Â|Ầ|Ấ|Ậ|Ẩ|Ẫ|Ă|Ằ|Ắ|Ặ|Ẳ|Ẵ/g,"A")).replace(/È|É|Ẹ|Ẻ|Ẽ|Ê|Ề|Ế|Ệ|Ể|Ễ/g,"E")).replace(/Ì|Í|Ị|Ỉ|Ĩ/g,"I")).replace(/Ò|Ó|Ọ|Ỏ|Õ|Ô|Ồ|Ố|Ộ|Ổ|Ỗ|Ơ|Ờ|Ớ|Ợ|Ở|Ỡ/g,"O")).replace(/Ù|Ú|Ụ|Ủ|Ũ|Ư|Ừ|Ứ|Ự|Ử|Ữ/g,"U")).replace(/Ỳ|Ý|Ỵ|Ỷ|Ỹ/g,"Y")).replace(/Đ/g,"D")).replace(/\u0300|\u0301|\u0303|\u0309|\u0323/g,"")).replace(/\u02C6|\u0306|\u031B/g,"")).replace(/ + /g," ")).trim()).replace(/!|@|%|\^|\*|\(|\)|\+|\=|\<|\>|\?|\/|,|\.|\:|\;|\'|\"|\&|\#|\[|\]|~|\$|_|`|-|{|}|\||\\/g," ")}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}})},1746:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},2116:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"HttpException",{enumerable:!0,get:function(){return o}});const r=a(8931),n=a(1548),u=a(9344);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class o{constructor(e){s(this,"message",void 0),s(this,"statusCode",void 0),this.message=e.message,this.statusCode=(0,r.isHttpError)(e)?e.status:e instanceof u.JsonWebTokenError?n.HttpStatusCode.UNAUTHORIZED:n.HttpStatusCode.INTERNAL_SERVER_ERROR}}},6468:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AllowedMimeType",{enumerable:!0,get:function(){return a}}),function(e){e.MS_POWERPOINT="application/vnd.ms-powerpoint",e.MS_EXCEL="application/vnd.ms-excel",e.MS_WORD="application/msword",e.POWERPOINT="application/vnd.openxmlformats-officedocument.presentationml.presentation",e.EXCEL="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",e.WORD="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.PDF="application/pdf",e.ZIP="application/zip",e.RAR="application/vnd.rar",e.PNG="image/png",e.JPG="image/jpeg"}(a||(a={}))},8324:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PermissionActionsEnum",{enumerable:!0,get:function(){return a}}),function(e){e.GET="GET",e.CREATE="CREATE",e.UPDATE="UPDATE",e.DELETE="DELETE"}(a||(a={}))},3111:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AuthRedisKeyPrefix",{enumerable:!0,get:function(){return a}}),function(e){e.ACCESS_TOKEN="[AT]-",e.REFRESH_TOKEN="[RT]-",e.OTP_KEY="[OTP]-"}(a||(a={}))},3:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"StudentQualityEnum",{enumerable:!0,get:function(){return a}}),function(e){e.BAD="Yếu",e.NORMAL="Trung bình",e.OK="Khá",e.GOOD="Tốt"}(a||(a={}))},6880:(e,t)=>{var a,r;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{UserGenderEnum:function(){return a},UserRoleEnum:function(){return r}}),function(e){e.MALE="Nam",e.FEMALE="Nữ"}(a||(a={})),function(e){e.HEADMASTER="Headmaster",e.TEACHER="Teacher",e.PARENTS="Parents"}(r||(r={}))},7601:e=>{e.exports=require("@vonage/server-sdk")},7096:e=>{e.exports=require("bcrypt")},9710:e=>{e.exports=require("cookie-parser")},3582:e=>{e.exports=require("cors")},1081:e=>{e.exports=require("dotenv/config")},6860:e=>{e.exports=require("express")},6508:e=>{e.exports=require("express-session")},9993:e=>{e.exports=require("googleapis")},8931:e=>{e.exports=require("http-errors")},8506:e=>{e.exports=require("joi")},9344:e=>{e.exports=require("jsonwebtoken")},2245:e=>{e.exports=require("moment")},1185:e=>{e.exports=require("mongoose")},314:e=>{e.exports=require("mongoose-autopopulate")},3760:e=>{e.exports=require("mongoose-delete")},2365:e=>{e.exports=require("mongoose-lean-virtuals")},8037:e=>{e.exports=require("mongoose-paginate-v2")},9470:e=>{e.exports=require("morgan")},1738:e=>{e.exports=require("multer")},5184:e=>{e.exports=require("nodemailer")},3511:e=>{e.exports=require("passport")},8117:e=>{e.exports=require("passport-google-oauth2")},7055:e=>{e.exports=require("passport-local")},7773:e=>{e.exports=require("redis")},7777:e=>{e.exports=require("swagger-jsdoc")},9948:e=>{e.exports=require("swagger-ui-express")},3685:e=>{e.exports=require("http")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var u=t[r]={exports:{}};return e[r](u,u.exports,a),u.exports}(()=>{const e=n(a(4559));a(1081);const t=n(a(3685)),r=n(a(8438));function n(e){return e&&e.__esModule?e:{default:e}}a(9123),a(1746);const u=t.default.createServer(e.default),s=process.env.PORT||3004;u.listen(s,(()=>{console.log(`[SUCCESS] ::: Server is listening on port: ${s}`),console.log(`[INFO] ::: API document available on: http://localhost:${s}/api/document`)})),(0,r.default)()})()})();